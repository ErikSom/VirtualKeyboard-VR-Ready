!function(a,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((a=a||self).VRKeyboard={})}(this,(function(a){"use strict";const r=["en","fr","es","ru"],c={en:[[{char:"q",extra:[{char:"1"}],alt:"1"},{char:"w",extra:[{char:"2"}],alt:"2"},{char:"e",extra:[{char:"è"},{char:"3"},{char:"é"},{char:"ê"},{char:"ę"},{char:"ë"},{char:"ē"},{char:"ė"}],alt:"3"},{char:"r",extra:[{char:"4"}],alt:"4"},{char:"t",extra:[{char:"5"}],alt:"5"},{char:"y",extra:[{char:"ý"},{char:"6"},{char:"ĳ"},{char:"ÿ"}],alt:"6"},{char:"u",extra:[{char:"û"},{char:"7"},{char:"ú"},{char:"ū"},{char:"ü"},{char:"ù"}],alt:"7"},{char:"i",extra:[{char:"î"},{char:"8"},{char:"í"},{char:"ï"},{char:"į"},{char:"ī"},{char:"ì"},{char:"ĳ"}],alt:"8"},{char:"o",extra:[{char:"ò"},{char:"ö"},{char:"ô"},{char:"9"},{char:"ó"},{char:"õ"},{char:"ō"},{char:"œ"},{char:"ø"}],alt:"9"},{char:"p",extra:[{char:"0"}],alt:"0"}],[{char:"a",extra:[{char:"à"},{char:"á"},{char:"â"},{char:"ä"},{char:"æ"},{char:"ã"},{char:"å"},{char:"ā"},{char:"ª"}]},{char:"s",extra:[{char:"ß"}]},{char:"d"},{char:"f"},{char:"g"},{char:"h"},{char:"j",extra:[{char:"j́"}]},{char:"k"},{char:"l"}],[{char:"shift",w:1.5},{char:"z"},{char:"x"},{char:"c",extra:[{char:"ç"}]},{char:"v"},{char:"b"},{char:"n",extra:[{char:"ñ"},{char:"ń"}]},{char:"m"},{char:"bksp",w:1.5}],[{char:"?123",w:2},{char:","},{char:"lang"},{char:"space",w:3},{char:"."},{char:"enter",w:2}]],fr:[[{char:"a",extra:[{char:"à"},{char:"á"},{char:"1"},{char:"â"},{char:"ä"},{char:"æ"},{char:"ã"},{char:"å"},{char:"ā"},{char:"ª"}],alt:"1"},{char:"z",extra:[{char:"2"}],alt:"2"},{char:"e",extra:[{char:"è"},{char:"3"},{char:"é"},{char:"ê"},{char:"ę"},{char:"ë"},{char:"ē"},{char:"ė"}],alt:"3"},{char:"r",extra:[{char:"4"}],alt:"4"},{char:"t",extra:[{char:"5"}],alt:"5"},{char:"y",extra:[{char:"ý"},{char:"6"},{char:"ĳ"},{char:"ÿ"}],alt:"6"},{char:"u",extra:[{char:"û"},{char:"7"},{char:"ú"},{char:"ū"},{char:"ü"},{char:"ù"}],alt:"7"},{char:"i",extra:[{char:"î"},{char:"8"},{char:"í"},{char:"ï"},{char:"į"},{char:"ī"},{char:"ì"},{char:"ĳ"}],alt:"8"},{char:"o",extra:[{char:"ò"},{char:"ö"},{char:"ô"},{char:"9"},{char:"ó"},{char:"õ"},{char:"ō"},{char:"œ"},{char:"ø"}],alt:"9"},{char:"p",extra:[{char:"0"}],alt:"0"}],[{char:"q"},{char:"s",extra:[{char:"ß"}]},{char:"d"},{char:"f"},{char:"g"},{char:"h"},{char:"j",extra:[{char:"j́"}]},{char:"k"},{char:"l"},{char:"m"}],[{char:"shift",w:1.5},{char:"w"},{char:"x"},{char:"c",extra:[{char:"ç"}]},{char:"v"},{char:"b"},{char:"n",extra:[{char:"ñ"},{char:"ń"}]},{char:"'",extra:[{char:"‚"},{char:"‘"},{char:"’"},{char:"‹"},{char:"›"}]},{char:"bksp",w:1.5}],[{char:"?123",w:2},{char:","},{char:"lang"},{char:"space",w:3},{char:"."},{char:"enter",w:2}]],es:[[{char:"q",extra:[{char:"1"}],alt:"1"},{char:"w",extra:[{char:"2"}],alt:"2"},{char:"e",extra:[{char:"è"},{char:"3"},{char:"é"},{char:"ê"},{char:"ę"},{char:"ë"},{char:"ē"},{char:"ė"}],alt:"3"},{char:"r",extra:[{char:"4"}],alt:"4"},{char:"t",extra:[{char:"5"}],alt:"5"},{char:"y",extra:[{char:"ý"},{char:"6"},{char:"ĳ"},{char:"ÿ"}],alt:"6"},{char:"u",extra:[{char:"û"},{char:"7"},{char:"ú"},{char:"ū"},{char:"ü"},{char:"ù"}],alt:"7"},{char:"i",extra:[{char:"î"},{char:"8"},{char:"í"},{char:"ï"},{char:"į"},{char:"ī"},{char:"ì"},{char:"ĳ"}],alt:"8"},{char:"o",extra:[{char:"ò"},{char:"ö"},{char:"ô"},{char:"9"},{char:"ó"},{char:"õ"},{char:"ō"},{char:"œ"},{char:"ø"}],alt:"9"},{char:"p",extra:[{char:"0"}],alt:"0"}],[{char:"a",extra:[{char:"à"},{char:"á"},{char:"â"},{char:"ä"},{char:"æ"},{char:"ã"},{char:"å"},{char:"ā"},{char:"ª"}]},{char:"s",extra:[{char:"ß"}]},{char:"d"},{char:"f"},{char:"g"},{char:"h"},{char:"j",extra:[{char:"j́"}]},{char:"k"},{char:"l"},{char:"ñ"}],[{char:"shift",w:1.5},{char:"z"},{char:"x"},{char:"c",extra:[{char:"ç"}]},{char:"v"},{char:"b"},{char:"n",extra:[{char:"ñ"},{char:"ń"}]},{char:"m"},{char:"bksp",w:1.5}],[{char:"?123",w:2},{char:","},{char:"lang"},{char:"space",w:3},{char:"."},{char:"enter",w:2}]],ru:[[{char:"й",extra:[{char:"1"}],alt:"1"},{char:"ц",extra:[{char:"2"}],alt:"2"},{char:"у",extra:[{char:"3"},{char:"у́"}],alt:"3"},{char:"к",extra:[{char:"4"}],alt:"4"},{char:"е",extra:[{char:"е́"},{char:"5"},{char:"ё"}],alt:"5"},{char:"н",extra:[{char:"6"}],alt:"6"},{char:"г",extra:[{char:"7"},{char:"ґ"}],alt:"7"},{char:"ш",extra:[{char:"8"}],alt:"8"},{char:"щ",extra:[{char:"9"}],alt:"9"},{char:"з",extra:[{char:"0"}],alt:"0"},{char:"х"}],[{char:"ф"},{char:"ы",extra:[{char:"ы́"}]},{char:"в"},{char:"а",extra:[{char:"а́"}]},{char:"п"},{char:"р"},{char:"о",extra:[{char:"о́"}]},{char:"л"},{char:"д"},{char:"ж"},{char:"э",extra:[{char:"є"},{char:"э́"}]}],[{char:"shift"},{char:"я",extra:[{char:"я́"}]},{char:"ч"},{char:"с"},{char:"м"},{char:"и",extra:[{char:"ї"},{char:"и́"},{char:"і"}]},{char:"т"},{char:"ь",extra:[{char:"ъ"}]},{char:"б"},{char:"ю",extra:[{char:"ю́"}]},{char:"bksp"}],[{char:"?123",w:2},{char:","},{char:"lang"},{char:"space",w:4},{char:"."},{char:"enter",w:2}]],num:[[{char:"1",extra:[{char:"¹"},{char:"½"},{char:"⅓"},{char:"¼"},{char:"⅕"},{char:"⅙"},{char:"⅐"},{char:"⅛"},{char:"⅑"},{char:"⅒"}]},{char:"2",extra:[{char:"⅖"},{char:"²"},{char:"⅔"}]},{char:"3",extra:[{char:"⅗"},{char:"³"},{char:"¾"},{char:"⅜"}]},{char:"4",extra:[{char:"⁴"},{char:"⅘"}]},{char:"5",extra:[{char:"⅝"},{char:"⁵"},{char:"⅚"}]},{char:"6",extra:[{char:"⁶"}]},{char:"7",extra:[{char:"⁷"},{char:"⅞"}]},{char:"8",extra:[{char:"⁸"}]},{char:"9",extra:[{char:"⁹"}]},{char:"0",extra:[{char:"∅"},{char:"ⁿ"},{char:"⁰"}]}],[{char:"@"},{char:"#",extra:[{char:"№"}]},{char:"$",extra:[{char:"₱"},{char:"€"},{char:"¢"},{char:"£"},{char:"¥"}]},{char:"_"},{char:"&"},{char:"-",extra:[{char:"—"},{char:"_"},{char:"–"},{char:"·"}]},{char:"+",extra:[{char:"±"}]},{char:"(",extra:[{char:"["},{char:"<"},{char:"{"}]},{char:")",extra:[{char:"]"},{char:">"},{char:"}"}]},{char:"/"}],[{char:"=\\<",w:1.5},{char:"*",extra:[{char:"★"},{char:"†"},{char:"‡"}]},{char:'"',extra:[{char:"„"},{char:"“"},{char:"”"},{char:"«"},{char:"»"}]},{char:"'",extra:[{char:"‚"},{char:"‘"},{char:"’"},{char:"‹"},{char:"›"}]},{char:":"},{char:";"},{char:"!",extra:[{char:"¡"}]},{char:"?",extra:[{char:"¿"},{char:"‽"}]},{char:"bksp",w:1.5}],[{char:"abc",w:1.5},{char:","},{char:"1234"},{char:"space",w:4},{char:"."},{char:"enter",w:1.5}]],nump:[[{char:"+",extra:[{char:"-"}]},{char:"1",w:2},{char:"2",w:2},{char:"3",w:2},{char:"%"}],[{char:"*"},{char:"4",w:2},{char:"5",w:2},{char:"6",w:2},{char:"space"}],[{char:"/"},{char:"7",w:2},{char:"8",w:2},{char:"9",w:2},{char:"bksp"}],[{char:"abc"},{char:","},{char:"!?#"},{char:"0",w:2},{char:"="},{char:"."},{char:"enter"}]],sym:[[{char:"〜"},{char:"`"},{char:"|"},{char:"•",extra:[{char:"♣"},{char:"♠"},{char:"♪"},{char:"♥"},{char:"♦"}]},{char:"√"},{char:"π",extra:[{char:"Ω"},{char:"Π"},{char:"μ"}]},{char:"÷"},{char:"×"},{char:"¶",extra:["§"]},{char:"Δ"}],[{char:"£"},{char:"€"},{char:"$",extra:[{char:"₱"},{char:"€"},{char:"¢"},{char:"£"},{char:"¥"}]},{char:"¢"},{char:"^",extra:[{char:"←"},{char:"↑"},{char:"↓"},{char:"→"}]},{char:"°",extra:[{char:"′"},{char:"″"}]},{char:"=",extra:[{char:"∞"},{char:"≠"},{char:"≈"}]},{char:"{",extra:[{char:"("}]},{char:"}",extra:[{char:")"}]},{char:"\\"}],[{char:"?123",w:1.5},{char:"%",extra:[{char:"‰"},{char:"℅"}]},{char:"©"},{char:"®"},{char:"™"},{char:"✓"},{char:"["},{char:"]"},{char:"bksp",w:1.5}],[{char:"abc",w:1.5},{char:"<"},{char:"space",w:5},{char:">"},{char:"enter",w:1.5}]]};r.forEach(a=>{const t=c[a][3][2];t.extra=[],r.forEach(a=>{t.extra.push({char:a.toUpperCase()})})});const t={resolution:1,aspect:1.25,margin:5,fontSize:16,buttonHeight:40,buttonRadius:5,language:"en",font:"sans-serif",align:"center",colors:{idle:"#3f4a52",hover:"#2d343a",down:"#5cb0a7",text:"#ffffff"},keyShadow:{shadowColor:"rgba(0, 0, 0, .3)",shadowBlur:1,shadowOffsetX:1,shadowOffsetY:1},popupShadow:{shadowColor:"rgba(0, 0, 0, .3)",shadowBlur:4,shadowOffsetX:0,shadowOffsetY:2},holdPopupTime:300,bkspIntervalTime:50},h=document.createElement("canvas"),e=h.getContext("2d"),M={bksp:"5MTEuMyA2ODMuNSI+PHBhdGggZD0iTTgzNS40IDBIMjY1LjhjLTI2LjIgMC00Ni43IDEzLjMtNjAuNCAzMy40TDAgMzQxLjhsMjA1LjQgMzA4YzEzLjcgMjAuMSAzNC4yIDMzLjggNjAuNCAzMy44aDU2OS42YzQxLjggMCA3NS45LTM0LjIgNzUuOS03NS45Vjc1LjljMC00MS43LTM0LjEtNzUuOS03NS45LTc1Ljl6bTAgNjA3LjZIMjY4LjVMOTEuMSAzNDEuOCAyNjguMSA3Nmg1NjcuM3Y1MzEuNnptLTQ0MC4xLTc2bDEzNi4zLTEzNi4zIDEzNi4zIDEzNi4zIDUzLjUtNTMuNS0xMzYuMi0xMzYuMyAxMzYuMy0xMzYuM0w2NjggMTUyIDUzMS42IDI4OC4yIDM5NS4zIDE1MS45bC01My41IDUzLjUgMTM2LjMgMTM2LjMtMTM2LjMgMTM2LjQgNTMuNSA1My41eiIvPjwvc3ZnPg==",shift:"5MTEuMyA2ODcuNSI+PHBhdGggZD0iTTQ1NS42IDY4Ny41Yy0zMy43IDAtNjUuNC0uMi04OS40LS41LTQ1LjItLjYtNDguMi0xLjQtNTIuOC0yLjgtMTcuMy00LjktMzIuMS0xNy45LTM5LjYtMzQuN2wtNS44LTEyLjgtLjMtMTMwLjctLjItOTFoLTM4LjRjLTQxLjYgMC02MC42IDAtNzIuNC0xLjEtMTQtMS4zLTI5LjYtNS4xLTM5LjQtMjQuMS01LjktMTEuMy05LjUtMjkuNCA3LTUxLjJsLjEtLjJjNi4xLTggMTEzLjEtMTI3LjcgMTQ1LjctMTY0LjIgMzYuNS00MC44IDcwLjYtNzguOSA5Ni4yLTEwNy40QzQxMiAxNS45IDQxMi42IDE1LjQgNDE1LjggMTNsLjUtLjRjNS44LTQuMyAxMy4zLTcuOCAxOC05LjVsLjUtLjJjMTYuOS01LjcgMzcuMi0zLjYgNTMuMSA1LjRsLjEuMWM5LjIgNS4zIDExLjEgNi4zIDE1Ny4xIDE2OS44IDU1LjIgNjEuNyA4OS42IDEwMC41IDExMS44IDEyNS44IDM1LjQgNDAuNCAzNi42IDQyLjkgMzkgNDkuMyA4LjggMjIuOC0uNSA0Ni0yMi44IDU2LjRsLS45LjRjLTExLjUgNC45LTE3LjQgNC45LTg5LjMgNC45SDY0NGwtLjIgOTEtLjQgMTMwLjctNS43IDEyLjdjLTcuNCAxNi44LTIyLjMgMjkuOC0zOS43IDM0LjgtNS4yIDEuNS0xMiAzLjMtMTQyLjQgMy4zek01NzcuOCA2MjNzMCAuMSAwIDB6bS0yNDQuMy0yLjFjMzcuOSAxLjYgMjA2LjYgMS42IDI0NC41IDBsLjMtMTE1IC4zLTE1Ni4yaDEzMWMtMjcuNC0zMS4zLTcxLTgwLjEtMTEzLjUtMTI3LjdDNTE2LjMgMTMyLjggNDY4LjggNzkuOSA0NTUgNjYuMiA0MjcuNiA5NiAyNjUuNSAyNzcuNCAyMDEuNCAzNDkuN2gxMzEuM0wzMzMgNTA2bC41IDExNC45eiIvPjwvc3ZnPg==",shift_perm:"5MTEuMyA4MzMuNCI+PHBhdGggZD0iTTQ1NS41IDY4Ny44Yy0zMy43IDAtNjUuNC0uMi04OS40LS41LTQ1LjItLjYtNDguMi0xLjQtNTIuOC0yLjgtMTcuMy00LjktMzIuMS0xNy45LTM5LjYtMzQuN0wyNjggNjM3bC0uNC0xMzAuNy0uMi05MUgyMjljLTQxLjYgMC02MC42IDAtNzIuNC0xLjEtMTQtMS4zLTI5LjYtNS4xLTM5LjQtMjQuMS01LjktMTEuMy05LjUtMjkuNCA3LTUxLjJsLjEtLjJjNi4xLTggMTEzLjEtMTI3LjcgMTQ1LjctMTY0LjIgMzYuNS00MC44IDcwLjYtNzguOSA5Ni4yLTEwNy40IDQ1LjctNTAuOSA0Ni40LTUxLjQgNDkuNS01My44bC41LS40YzUuOC00LjMgMTMuMy03LjggMTgtOS41bC41LS4yYzE2LjktNS43IDM3LjItMy42IDUzLjEgNS40bC4xLjFDNDk3LjEgMTQgNDk5IDE1IDY0NSAxNzguNWM1NS4yIDYxLjcgODkuNiAxMDAuNSAxMTEuOCAxMjUuOCAzNS40IDQwLjQgMzYuNiA0Mi45IDM5IDQ5LjMgOC44IDIyLjgtLjUgNDYtMjIuOCA1Ni40bC0uOS40Yy0xMS41IDQuOS0xNy40IDQuOS04OS4zIDQuOUg2NDRsLS4yIDkxLS41IDEzMC43LTUuNyAxMi43Yy03LjQgMTYuOC0yMi4zIDI5LjgtMzkuNyAzNC44LTUuMiAxLjUtMTIgMy4zLTE0Mi40IDMuM3ptMTIyLjItNjQuNXMwIC4xIDAgMHoiLz48cGF0aCBkPSJNMzAzLjggNzk3LjRoMzA0IiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iNzIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIi8+PC9zdmc+",shift_down:"5MTEuMyA2ODcuNSI+PHBhdGggZD0iTTQ1NS42IDY4Ny41Yy0zMy43IDAtNjUuNC0uMi04OS40LS41LTQ1LjItLjYtNDguMi0xLjQtNTIuOC0yLjgtMTcuMy00LjktMzIuMS0xNy45LTM5LjYtMzQuN2wtNS44LTEyLjgtLjMtMTMwLjctLjItOTFoLTM4LjRjLTQxLjYgMC02MC42IDAtNzIuNC0xLjEtMTQtMS4zLTI5LjYtNS4xLTM5LjQtMjQuMS01LjktMTEuMy05LjUtMjkuNCA3LTUxLjJsLjEtLjJjNi4xLTggMTEzLjEtMTI3LjcgMTQ1LjctMTY0LjIgMzYuNS00MC44IDcwLjYtNzguOSA5Ni4yLTEwNy40QzQxMiAxNS45IDQxMi42IDE1LjQgNDE1LjggMTNsLjUtLjRjNS44LTQuMyAxMy4zLTcuOCAxOC05LjVsLjUtLjJjMTYuOS01LjcgMzcuMi0zLjYgNTMuMSA1LjRsLjEuMWM5LjIgNS4zIDExLjEgNi4zIDE1Ny4xIDE2OS44IDU1LjIgNjEuNyA4OS42IDEwMC41IDExMS44IDEyNS44IDM1LjQgNDAuNCAzNi42IDQyLjkgMzkgNDkuMyA4LjggMjIuOC0uNSA0Ni0yMi44IDU2LjRsLS45LjRjLTExLjUgNC45LTE3LjQgNC45LTg5LjMgNC45SDY0NGwtLjIgOTEtLjQgMTMwLjctNS43IDEyLjdjLTcuNCAxNi44LTIyLjMgMjkuOC0zOS43IDM0LjgtNS4yIDEuNS0xMiAzLjMtMTQyLjQgMy4zek01NzcuOCA2MjNzMCAuMSAwIDB6Ii8+PC9zdmc+",enter:"xMDAwIDY4Ny41Ij48cGF0aCBkPSJNODgxLjIgMHYzMzIuNUgzNDUuOVY5NS43TC0uMyAzOTEuN2wzNDYuMiAyOTUuOFY0NTAuN2g1OTQuNWMzMi43IDAgNTkuMi0yNi41IDU5LjItNTkuMlYwSDg4MS4yeiIvPjwvc3ZnPg==",lang:"5MTEuMyA2ODMuNSI+PHBhdGggZD0iTTQ1Ni4yLjhjLTE4OC4yIDAtMzQwLjYgMTUyLjgtMzQwLjYgMzQxczE1Mi40IDM0MSAzNDAuNiAzNDFjMTg4LjYgMCAzNDEuMy0xNTIuOCAzNDEuMy0zNDFTNjQ0LjguOCA0NTYuMi44em0yMzYuMyAyMDQuNkg1OTEuOWMtMTAuOS00Mi43LTI2LjYtODMuNi00Ny0xMjEuNCA2Mi43IDIxLjQgMTE0LjkgNjUuMSAxNDcuNiAxMjEuNHpNNDU2LjYgNzAuM2MyOC4zIDQwLjkgNTAuNSA4Ni4zIDY1LjEgMTM1SDM5MS40YzE0LjctNDguNyAzNi44LTk0LjEgNjUuMi0xMzV6bS0yNjQgMzM5LjZjLTUuNS0yMS44LTguOS00NC43LTguOS02OC4yczMuNC00Ni40IDguOS02OC4yaDExNS4zYy0yLjcgMjIuNS00LjggNDUtNC44IDY4LjJzMiA0NS43IDQuOCA2OC4ySDE5Mi42em0yOCA2OC4yaDEwMC42YzEwLjkgNDIuNiAyNi42IDgzLjUgNDcuMSAxMjEuNC02Mi44LTIxLjQtMTE1LTY0LjgtMTQ3LjctMTIxLjR6bTEwMC42LTI3Mi43SDIyMC42YzMyLjctNTYuNiA4NC45LTk5LjkgMTQ3LjYtMTIxLjQtMjAuNCAzNy44LTM2LjEgNzguNy00NyAxMjEuNHptMTM1LjQgNDA3LjhjLTI4LjMtNDAuOS01MC41LTg2LjMtNjUuMS0xMzVoMTMwLjNjLTE0LjggNDguNy0zNi45IDk0LjEtNjUuMiAxMzV6bTc5LjctMjAzLjNIMzc2LjhjLTMuMS0yMi41LTUuNS00NS01LjUtNjguMnMyLjQtNDYgNS41LTY4LjJoMTU5LjZjMy4xIDIyLjIgNS41IDQ1IDUuNSA2OC4ycy0yLjUgNDUuNy01LjYgNjguMnptOC42IDE4OS42YzIwLjUtMzcuOCAzNi4xLTc4LjggNDcuMS0xMjEuNGgxMDAuNmMtMzIuOCA1Ni4zLTg1IDEwMC0xNDcuNyAxMjEuNHptNjAuMy0xODkuNmMyLjctMjIuNSA0LjgtNDUgNC44LTY4LjJzLTItNDUuNy00LjgtNjguMmgxMTUuM2M1LjUgMjEuOCA4LjkgNDQuNyA4LjkgNjguMnMtMy40IDQ2LjQtOC45IDY4LjJINjA1LjJ6Ii8+PC9zdmc+",cached:{}},i=()=>{const a=Object.keys(M).filter(a=>!1===["cached"].includes(a)),r=[];return a.forEach(a=>{r.push((a=>new Promise(r=>{if(M.cached[a])return r(M.cached[a]);const c=new Image;c.src="".concat("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA").concat(M[a]),c.onload=()=>{M.cached[a]=c,r(c)}}))(a))}),Promise.all(r)},n=(a,r,c,i,n,l)=>{const u=M.cached[l];if(!u)return;const o=u.width/u.height;e.clearRect(0,0,h.width,h.height),h.width=t.fontSize*t.resolution*1.5,h.height=h.width/o;const L=(i-h.width)/2,j=(n-h.height)/2;e.drawImage(u,0,0,h.width,h.height),e.fillStyle=a.fillStyle;const s=e.globalCompositeOperation;e.globalCompositeOperation="source-in",e.fillRect(0,0,h.width,h.height),e.globalCompositeOperation=s,a.drawImage(h,r+L,c+j,h.width,h.height)};function l(){}Object.assign(l.prototype,{addEventListener:function(a,r){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]),-1===c[a].indexOf(r)&&c[a].push(r)},removeEventListener:function(a,r){if(void 0!==this._listeners){var c=this._listeners[a];if(void 0!==c){var t=c.indexOf(r);-1!==t&&c.splice(t,1)}}},dispatchEvent:function(a){if(void 0!==this._listeners){var r=this._listeners[a.type];if(void 0!==r){a.target=this;for(var c=r.slice(0),t=0,h=c.length;t<h;t++)c[t].call(this,a)}}}});const u=new l,o=(a,c)=>{let t=null;a.length<=2&&!r.includes(a.toLowerCase())&&(t=c?a.toUpperCase():a),"space"===a&&(t=" "),u.dispatchEvent({type:L,key:a,char:t})},L="keyDown";var j=Object.freeze({__proto__:null,dispatcher:u,addEventListener:(a,r)=>{u.addEventListener(a,r)},removeEventListener:(a,r)=>{u.removeEventListener(a,r)},dispatchEvent:o,KEYDOWN:L});const s=document.createElement("canvas"),N=s.getContext("2d"),g={x:0,y:0};let x=null,y=null,I=null,T=null,D=null,w=null,S=null,d=null,z=null,E=!1,A=null,C=!1,f=!1,p=0,O=!1,v=null;const m=a=>{c[a]&&(I=a,Y(a))},Y=a=>{D=c[a],w=a,T=V();const r=(T+1)*S;d=(s.width-r)/T,R()},Q=(a,r,c)=>{E=a,void 0!==r?k(r,c):k(g.x,g.y)},k=(r,c)=>{let t;g.x=r,g.y=c,C&&(t=H()),t||(t=B()),!t&&a.activeElement&&(J(),R())},U=()=>{s.width=512*t.resolution,s.height=s.width/t.aspect,S=t.margin*t.resolution,z=t.buttonHeight*t.resolution,w&&Y(w)};a.textureDirty=!0;const b=(a,r,c,t,h)=>{c<2*h&&(h=c/2),t<2*h&&(h=t/2),N.beginPath(),N.moveTo(a+h,r),N.arcTo(a+c,r,a+c,r+t,h),N.arcTo(a+c,r+t,a,r+t,h),N.arcTo(a,r+t,a,r,h),N.arcTo(a,r,a+c,r,h),N.closePath(),N.fill()},P=(a,r,c,h,e,M)=>{if(M||(M=t.fontSize*t.resolution),N.font="".concat(M,"px ").concat(t.font),N.textBaseline="middle",!e)return;const i=(c-N.measureText(e).width)/2,n=h/2;N.fillText(e,a+i,r+n)},R=()=>{const r=F();N.clearRect(0,0,s.width,s.height),N.shadowBlur=t.keyShadow.shadowBlur,N.shadowOffsetX=t.keyShadow.shadowOffsetX,N.shadowOffsetY=t.keyShadow.shadowOffsetY;let c=r;for(let a=0;a<D.length;a++){const r=D[a];let h=S+G()+q(a);for(let a=0;a<r.length;a++){const e=r[a];let M=e.w?e.w:1;N.fillStyle=t.colors.hover,e.down?N.fillStyle=t.colors.down:e.hover?N.fillStyle=t.colors.hover:N.fillStyle=t.colors.idle;let i=d*M;if(i+=(M-1)*S,N.shadowColor=t.keyShadow.shadowColor,b(h,c,i,z,t.buttonRadius*t.resolution),N.shadowColor="transparent",N.fillStyle=t.colors.text,e.pos={x:h,y:c},["shift","bksp","enter","lang"].includes(e.char)){let a=e.char;"shift"===e.char&&f&&(a="shift_down"),"shift"===e.char&&O&&(a="shift_perm"),n(N,h,c,i,z,a)}else{let a=f&&1===e.char.length?e.char.toUpperCase():e.char;if("space"===a&&(a="␣"),P(h,c,i,z,a),e.alt){const a=.6*t.fontSize*t.resolution;P(h+i/2-a/2,c-z/2+a,i,z,e.alt,a)}}h+=i+S}c+=z+S}if(N.shadowBlur=t.popupShadow.shadowBlur,N.shadowOffsetX=t.popupShadow.shadowOffsetX,N.shadowOffsetY=t.popupShadow.shadowOffsetY,a.activeElement&&a.activeElement.extra&&a.activeElement.down){const{pos:r}=a.activeElement,{startX:c,startY:h,keyArr:e,popupWidth:M,popupHeight:i}=$(r,C?[...a.activeElement.extra]:[a.activeElement]);N.fillStyle=t.colors.idle,N.shadowColor=t.popupShadow.shadowColor,b(c,h-z*(e.length-1),M,i,t.buttonRadius*t.resolution),b(r.x,r.y-z,d,2*z,t.buttonRadius*t.resolution),N.shadowColor="transparent";let n=h;for(let a=0;a<e.length;a++){const r=e[a];let h=c;for(let a=0;a<r.length;a++){const c=r[a];c.down?N.fillStyle=t.colors.down:c.hover?N.fillStyle=t.colors.hover:N.fillStyle=t.colors.idle,b(h,n,d,z,t.buttonRadius*t.resolution),N.fillStyle=t.colors.text;const e=f&&c.char.length<=2?c.char.toUpperCase():c.char;P(h,n,d,z,e),C||P(h,n+z/2,d,z/2,"..."),h+=d}n-=z}}a.textureDirty=!0},B=()=>{const{x:r,y:c}=g,t=F(),h=Math.floor((c-t)/(z+S)),e=D[h];if(!e)return;let M=S+G()+q(h);for(let c=0;c<e.length;c++){const t=e[c];let h=t.w?t.w:1,i=d*h;i+=(h-1)*S;let n=r>M;if(M+=i+S,n&&r<M-S){if(!a.activeElement||a.activeElement!==t||a.activeElement.down!==E){if(a.activeElement===t&&a.activeElement.down&&!E)return _(a.activeElement);J(),a.activeElement=t,a.activeElement.hover=!0,a.activeElement.down=E,a.activeElement.down?W():X(),R()}return a.activeElement}}},H=()=>{if(!a.activeElement||!a.activeElement.extra)return;if(!E)return _(x),!0;const{x:r,y:c}=g,{pos:t}=a.activeElement,{startX:h,startY:e,keyArr:M,popupWidth:i,popupHeight:n}=$(t,[...a.activeElement.extra]);let l=null,u=Number.POSITIVE_INFINITY,o=e+z/2;for(let a=0;a<M.length;a++){const t=M[a];let e=h+d/2;for(let a=0;a<t.length;a++){const h=t[a],M=r-e,i=c-o,n=Math.sqrt(M*M+i*i);n<u&&(l=h,u=n),e+=d}o-=z}return x&&x===l&&x.down===E||(Z(),x=l,x.hover=!0,x.down=!0,R()),r>h&&r<h+i&&c>e-z*(M.length-1)&&c<e-z*(M.length-1)+n||r>t.x&&r<t.x+d&&c>t.y-z&&c<t.y+z},_=a=>{Z(),J(),X();let c=!0;switch(o(a.char,f),a.char){case"abc":Y(I);break;case"!?#":case"?123":Y("num");break;case"=\\<":Y("sym");break;case"1234":Y("nump");break;case"shift":!O&&Date.now()-p<300?(f=!0,O=!0,p=0):(f=!f,O=!1,p=Date.now()),c=!1;break;case"lang":for(let a=0;a<r.length;a++)if(r[a]===I){let c=a+1;r[c]||(c=0),m(r[c]);break}break;default:r.includes(a.char.toLowerCase())?m(a.char.toLowerCase()):(f&&!O&&(f=!1),c=!1)}return c||R(),a},J=()=>{a.activeElement&&(a.activeElement.hover=!1,a.activeElement.down=!1,a.activeElement=null)},Z=()=>{x&&(x.hover=!1,x.down=!1,x=null)},X=()=>{A&&clearTimeout(A),v&&clearInterval(v),C=!1},W=()=>{X(),A=setTimeout(()=>{C=!0,Z(),H(),a.activeElement&&"bksp"===a.activeElement.char&&(v=setInterval(()=>{a.activeElement&&o(a.activeElement.char)},t.bkspIntervalTime))},t.holdPopupTime)},F=()=>"center"===t.align?s.height/2-D.length*z*.5:2*z+4*S,V=()=>{let a=0;for(let r=0;r<D.length;r++){const c=D[r];let t=0;for(let a=0;a<c.length;a++){const r=c[a];t+=r.w?r.w:1}t>a&&(a=t)}return a},G=()=>{let a=V();const r=(T-a)/2;return r*d+r*S},q=a=>{const r=D[a];let c=0;for(let a=0;a<r.length;a++){const t=r[a];c+=t.w?t.w:1}const t=(T-c)/2;return t*d+t*S},K=()=>(D.length*z+(D.length+1)*S+(2*z+3*S))/t.resolution,$=(a,r)=>{let c=5;r.length>c&&(c=Math.ceil(r.length/2));const t=new Array(Math.ceil(r.length/c)).fill().map(a=>r.splice(0,c)),h=t[0].length*d,e=t.length*z,M=Math.floor(t[0].length/2)*d;let i=a.x-M;for(t[0].length>1&&t[0].length%2==0&&(i+=d);i<0;)i+=d;for(;i+t[0].length*d>s.width;)i-=d;return{keyArr:t,popupWidth:h,popupHeight:e,startX:i,startY:a.y-z-3*S}};a.addListeners=()=>{const a=(a,r)=>(y=s.getBoundingClientRect(),a-=y.x,r-=y.y,[a*t.resolution,r*t.resolution]);document.addEventListener("mousemove",r=>{k(...a(r.clientX,r.clientY))}),s.addEventListener("mousedown",r=>{Q(!0,...a(r.clientX,r.clientY)),r.preventDefault()}),document.addEventListener("mouseup",a=>{Q(!1)}),document.addEventListener("touchmove",r=>{const c=r.touches[0];k(...a(c.clientX,c.clientY)),r.preventDefault()},{passive:!1}),s.addEventListener("touchstart",r=>{const c=r.touches[0];Q(!0,...a(c.clientX,c.clientY)),r.preventDefault()},{passive:!1}),document.addEventListener("touchend",a=>{Q(!1)},{passive:!1})},a.canvas=s,a.events=j,a.init=a=>{i().then(()=>{R()}),Object.assign(t,a),I=t.language,U(),m("en")},a.selectLanguage=m,a.setLayout=Y,a.setMouseDown=Q,a.setMousePos=k,a.setMousePosFromUV=(a,r)=>{k(s.width*a,s.height*r)},a.setScreenSizeFromAspectRatio=U,a.setScreenSizeInPixels=(a,r,c)=>{t.resolution=c,z=t.buttonHeight*t.resolution,S=t.margin*t.resolution;const h=K();r=Math.max(r,h),s.width=a*t.resolution,s.height=r*t.resolution,s.style.width="".concat(a,"px"),s.style.height="".concat(r,"px"),w&&Y(w)},a.setTextureDirty=r=>{a.textureDirty=r},Object.defineProperty(a,"__esModule",{value:!0})}));
