const a=["en","fr","es","ru"],r={en:[[{char:"q",extra:[{char:"1"}],alt:"1"},{char:"w",extra:[{char:"2"}],alt:"2"},{char:"e",extra:[{char:"è"},{char:"3"},{char:"é"},{char:"ê"},{char:"ę"},{char:"ë"},{char:"ē"},{char:"ė"}],alt:"3"},{char:"r",extra:[{char:"4"}],alt:"4"},{char:"t",extra:[{char:"5"}],alt:"5"},{char:"y",extra:[{char:"ý"},{char:"6"},{char:"ĳ"},{char:"ÿ"}],alt:"6"},{char:"u",extra:[{char:"û"},{char:"7"},{char:"ú"},{char:"ū"},{char:"ü"},{char:"ù"}],alt:"7"},{char:"i",extra:[{char:"î"},{char:"8"},{char:"í"},{char:"ï"},{char:"į"},{char:"ī"},{char:"ì"},{char:"ĳ"}],alt:"8"},{char:"o",extra:[{char:"ò"},{char:"ö"},{char:"ô"},{char:"9"},{char:"ó"},{char:"õ"},{char:"ō"},{char:"œ"},{char:"ø"}],alt:"9"},{char:"p",extra:[{char:"0"}],alt:"0"}],[{char:"a",extra:[{char:"à"},{char:"á"},{char:"â"},{char:"ä"},{char:"æ"},{char:"ã"},{char:"å"},{char:"ā"},{char:"ª"}]},{char:"s",extra:[{char:"ß"}]},{char:"d"},{char:"f"},{char:"g"},{char:"h"},{char:"j",extra:[{char:"j́"}]},{char:"k"},{char:"l"}],[{char:"shift",w:1.5},{char:"z"},{char:"x"},{char:"c",extra:[{char:"ç"}]},{char:"v"},{char:"b"},{char:"n",extra:[{char:"ñ"},{char:"ń"}]},{char:"m"},{char:"bksp",w:1.5}],[{char:"?123",w:2},{char:","},{char:"lang"},{char:"space",w:3},{char:"."},{char:"enter",w:2}]],fr:[[{char:"a",extra:[{char:"à"},{char:"á"},{char:"1"},{char:"â"},{char:"ä"},{char:"æ"},{char:"ã"},{char:"å"},{char:"ā"},{char:"ª"}],alt:"1"},{char:"z",extra:[{char:"2"}],alt:"2"},{char:"e",extra:[{char:"è"},{char:"3"},{char:"é"},{char:"ê"},{char:"ę"},{char:"ë"},{char:"ē"},{char:"ė"}],alt:"3"},{char:"r",extra:[{char:"4"}],alt:"4"},{char:"t",extra:[{char:"5"}],alt:"5"},{char:"y",extra:[{char:"ý"},{char:"6"},{char:"ĳ"},{char:"ÿ"}],alt:"6"},{char:"u",extra:[{char:"û"},{char:"7"},{char:"ú"},{char:"ū"},{char:"ü"},{char:"ù"}],alt:"7"},{char:"i",extra:[{char:"î"},{char:"8"},{char:"í"},{char:"ï"},{char:"į"},{char:"ī"},{char:"ì"},{char:"ĳ"}],alt:"8"},{char:"o",extra:[{char:"ò"},{char:"ö"},{char:"ô"},{char:"9"},{char:"ó"},{char:"õ"},{char:"ō"},{char:"œ"},{char:"ø"}],alt:"9"},{char:"p",extra:[{char:"0"}],alt:"0"}],[{char:"q"},{char:"s",extra:[{char:"ß"}]},{char:"d"},{char:"f"},{char:"g"},{char:"h"},{char:"j",extra:[{char:"j́"}]},{char:"k"},{char:"l"},{char:"m"}],[{char:"shift",w:1.5},{char:"w"},{char:"x"},{char:"c",extra:[{char:"ç"}]},{char:"v"},{char:"b"},{char:"n",extra:[{char:"ñ"},{char:"ń"}]},{char:"'",extra:[{char:"‚"},{char:"‘"},{char:"’"},{char:"‹"},{char:"›"}]},{char:"bksp",w:1.5}],[{char:"?123",w:2},{char:","},{char:"lang"},{char:"space",w:3},{char:"."},{char:"enter",w:2}]],es:[[{char:"q",extra:[{char:"1"}],alt:"1"},{char:"w",extra:[{char:"2"}],alt:"2"},{char:"e",extra:[{char:"è"},{char:"3"},{char:"é"},{char:"ê"},{char:"ę"},{char:"ë"},{char:"ē"},{char:"ė"}],alt:"3"},{char:"r",extra:[{char:"4"}],alt:"4"},{char:"t",extra:[{char:"5"}],alt:"5"},{char:"y",extra:[{char:"ý"},{char:"6"},{char:"ĳ"},{char:"ÿ"}],alt:"6"},{char:"u",extra:[{char:"û"},{char:"7"},{char:"ú"},{char:"ū"},{char:"ü"},{char:"ù"}],alt:"7"},{char:"i",extra:[{char:"î"},{char:"8"},{char:"í"},{char:"ï"},{char:"į"},{char:"ī"},{char:"ì"},{char:"ĳ"}],alt:"8"},{char:"o",extra:[{char:"ò"},{char:"ö"},{char:"ô"},{char:"9"},{char:"ó"},{char:"õ"},{char:"ō"},{char:"œ"},{char:"ø"}],alt:"9"},{char:"p",extra:[{char:"0"}],alt:"0"}],[{char:"a",extra:[{char:"à"},{char:"á"},{char:"â"},{char:"ä"},{char:"æ"},{char:"ã"},{char:"å"},{char:"ā"},{char:"ª"}]},{char:"s",extra:[{char:"ß"}]},{char:"d"},{char:"f"},{char:"g"},{char:"h"},{char:"j",extra:[{char:"j́"}]},{char:"k"},{char:"l"},{char:"ñ"}],[{char:"shift",w:1.5},{char:"z"},{char:"x"},{char:"c",extra:[{char:"ç"}]},{char:"v"},{char:"b"},{char:"n",extra:[{char:"ñ"},{char:"ń"}]},{char:"m"},{char:"bksp",w:1.5}],[{char:"?123",w:2},{char:","},{char:"lang"},{char:"space",w:3},{char:"."},{char:"enter",w:2}]],ru:[[{char:"й",extra:[{char:"1"}],alt:"1"},{char:"ц",extra:[{char:"2"}],alt:"2"},{char:"у",extra:[{char:"3"},{char:"у́"}],alt:"3"},{char:"к",extra:[{char:"4"}],alt:"4"},{char:"е",extra:[{char:"е́"},{char:"5"},{char:"ё"}],alt:"5"},{char:"н",extra:[{char:"6"}],alt:"6"},{char:"г",extra:[{char:"7"},{char:"ґ"}],alt:"7"},{char:"ш",extra:[{char:"8"}],alt:"8"},{char:"щ",extra:[{char:"9"}],alt:"9"},{char:"з",extra:[{char:"0"}],alt:"0"},{char:"х"}],[{char:"ф"},{char:"ы",extra:[{char:"ы́"}]},{char:"в"},{char:"а",extra:[{char:"а́"}]},{char:"п"},{char:"р"},{char:"о",extra:[{char:"о́"}]},{char:"л"},{char:"д"},{char:"ж"},{char:"э",extra:[{char:"є"},{char:"э́"}]}],[{char:"shift"},{char:"я",extra:[{char:"я́"}]},{char:"ч"},{char:"с"},{char:"м"},{char:"и",extra:[{char:"ї"},{char:"и́"},{char:"і"}]},{char:"т"},{char:"ь",extra:[{char:"ъ"}]},{char:"б"},{char:"ю",extra:[{char:"ю́"}]},{char:"bksp"}],[{char:"?123",w:2},{char:","},{char:"lang"},{char:"space",w:4},{char:"."},{char:"enter",w:2}]],num:[[{char:"1",extra:[{char:"¹"},{char:"½"},{char:"⅓"},{char:"¼"},{char:"⅕"},{char:"⅙"},{char:"⅐"},{char:"⅛"},{char:"⅑"},{char:"⅒"}]},{char:"2",extra:[{char:"⅖"},{char:"²"},{char:"⅔"}]},{char:"3",extra:[{char:"⅗"},{char:"³"},{char:"¾"},{char:"⅜"}]},{char:"4",extra:[{char:"⁴"},{char:"⅘"}]},{char:"5",extra:[{char:"⅝"},{char:"⁵"},{char:"⅚"}]},{char:"6",extra:[{char:"⁶"}]},{char:"7",extra:[{char:"⁷"},{char:"⅞"}]},{char:"8",extra:[{char:"⁸"}]},{char:"9",extra:[{char:"⁹"}]},{char:"0",extra:[{char:"∅"},{char:"ⁿ"},{char:"⁰"}]}],[{char:"@"},{char:"#",extra:[{char:"№"}]},{char:"$",extra:[{char:"₱"},{char:"€"},{char:"¢"},{char:"£"},{char:"¥"}]},{char:"_"},{char:"&"},{char:"-",extra:[{char:"—"},{char:"_"},{char:"–"},{char:"·"}]},{char:"+",extra:[{char:"±"}]},{char:"(",extra:[{char:"["},{char:"<"},{char:"{"}]},{char:")",extra:[{char:"]"},{char:">"},{char:"}"}]},{char:"/"}],[{char:"=\\<",w:1.5},{char:"*",extra:[{char:"★"},{char:"†"},{char:"‡"}]},{char:'"',extra:[{char:"„"},{char:"“"},{char:"”"},{char:"«"},{char:"»"}]},{char:"'",extra:[{char:"‚"},{char:"‘"},{char:"’"},{char:"‹"},{char:"›"}]},{char:":"},{char:";"},{char:"!",extra:[{char:"¡"}]},{char:"?",extra:[{char:"¿"},{char:"‽"}]},{char:"bksp",w:1.5}],[{char:"abc",w:1.5},{char:","},{char:"1234"},{char:"space",w:4},{char:"."},{char:"enter",w:1.5}]],nump:[[{char:"+",extra:[{char:"-"}]},{char:"1",w:2},{char:"2",w:2},{char:"3",w:2},{char:"%"}],[{char:"*"},{char:"4",w:2},{char:"5",w:2},{char:"6",w:2},{char:"space"}],[{char:"/"},{char:"7",w:2},{char:"8",w:2},{char:"9",w:2},{char:"bksp"}],[{char:"abc"},{char:","},{char:"!?#"},{char:"0",w:2},{char:"="},{char:"."},{char:"enter"}]],sym:[[{char:"〜"},{char:"`"},{char:"|"},{char:"•",extra:[{char:"♣"},{char:"♠"},{char:"♪"},{char:"♥"},{char:"♦"}]},{char:"√"},{char:"π",extra:[{char:"Ω"},{char:"Π"},{char:"μ"}]},{char:"÷"},{char:"×"},{char:"¶",extra:["§"]},{char:"Δ"}],[{char:"£"},{char:"€"},{char:"$",extra:[{char:"₱"},{char:"€"},{char:"¢"},{char:"£"},{char:"¥"}]},{char:"¢"},{char:"^",extra:[{char:"←"},{char:"↑"},{char:"↓"},{char:"→"}]},{char:"°",extra:[{char:"′"},{char:"″"}]},{char:"=",extra:[{char:"∞"},{char:"≠"},{char:"≈"}]},{char:"{",extra:[{char:"("}]},{char:"}",extra:[{char:")"}]},{char:"\\"}],[{char:"?123",w:1.5},{char:"%",extra:[{char:"‰"},{char:"℅"}]},{char:"©"},{char:"®"},{char:"™"},{char:"✓"},{char:"["},{char:"]"},{char:"bksp",w:1.5}],[{char:"abc",w:1.5},{char:"<"},{char:"space",w:5},{char:">"},{char:"enter",w:1.5}]]};a.forEach(c=>{const h=r[c][3][2];h.extra=[],a.forEach(a=>{h.extra.push({char:a.toUpperCase()})})});const c={resolution:1,aspect:1.25,margin:5,fontSize:16,buttonHeight:40,buttonRadius:5,language:"en",font:"sans-serif",align:"center",colors:{idle:"#3f4a52",hover:"#2d343a",down:"#5cb0a7",text:"#ffffff"},keyShadow:{shadowColor:"rgba(0, 0, 0, .3)",shadowBlur:1,shadowOffsetX:1,shadowOffsetY:1},popupShadow:{shadowColor:"rgba(0, 0, 0, .3)",shadowBlur:4,shadowOffsetX:0,shadowOffsetY:2},holdPopupTime:300,bkspIntervalTime:50},h=document.createElement("canvas"),t=h.getContext("2d"),e={bksp:"5MTEuMyA2ODMuNSI+PHBhdGggZD0iTTgzNS40IDBIMjY1LjhjLTI2LjIgMC00Ni43IDEzLjMtNjAuNCAzMy40TDAgMzQxLjhsMjA1LjQgMzA4YzEzLjcgMjAuMSAzNC4yIDMzLjggNjAuNCAzMy44aDU2OS42YzQxLjggMCA3NS45LTM0LjIgNzUuOS03NS45Vjc1LjljMC00MS43LTM0LjEtNzUuOS03NS45LTc1Ljl6bTAgNjA3LjZIMjY4LjVMOTEuMSAzNDEuOCAyNjguMSA3Nmg1NjcuM3Y1MzEuNnptLTQ0MC4xLTc2bDEzNi4zLTEzNi4zIDEzNi4zIDEzNi4zIDUzLjUtNTMuNS0xMzYuMi0xMzYuMyAxMzYuMy0xMzYuM0w2NjggMTUyIDUzMS42IDI4OC4yIDM5NS4zIDE1MS45bC01My41IDUzLjUgMTM2LjMgMTM2LjMtMTM2LjMgMTM2LjQgNTMuNSA1My41eiIvPjwvc3ZnPg==",shift:"5MTEuMyA2ODcuNSI+PHBhdGggZD0iTTQ1NS42IDY4Ny41Yy0zMy43IDAtNjUuNC0uMi04OS40LS41LTQ1LjItLjYtNDguMi0xLjQtNTIuOC0yLjgtMTcuMy00LjktMzIuMS0xNy45LTM5LjYtMzQuN2wtNS44LTEyLjgtLjMtMTMwLjctLjItOTFoLTM4LjRjLTQxLjYgMC02MC42IDAtNzIuNC0xLjEtMTQtMS4zLTI5LjYtNS4xLTM5LjQtMjQuMS01LjktMTEuMy05LjUtMjkuNCA3LTUxLjJsLjEtLjJjNi4xLTggMTEzLjEtMTI3LjcgMTQ1LjctMTY0LjIgMzYuNS00MC44IDcwLjYtNzguOSA5Ni4yLTEwNy40QzQxMiAxNS45IDQxMi42IDE1LjQgNDE1LjggMTNsLjUtLjRjNS44LTQuMyAxMy4zLTcuOCAxOC05LjVsLjUtLjJjMTYuOS01LjcgMzcuMi0zLjYgNTMuMSA1LjRsLjEuMWM5LjIgNS4zIDExLjEgNi4zIDE1Ny4xIDE2OS44IDU1LjIgNjEuNyA4OS42IDEwMC41IDExMS44IDEyNS44IDM1LjQgNDAuNCAzNi42IDQyLjkgMzkgNDkuMyA4LjggMjIuOC0uNSA0Ni0yMi44IDU2LjRsLS45LjRjLTExLjUgNC45LTE3LjQgNC45LTg5LjMgNC45SDY0NGwtLjIgOTEtLjQgMTMwLjctNS43IDEyLjdjLTcuNCAxNi44LTIyLjMgMjkuOC0zOS43IDM0LjgtNS4yIDEuNS0xMiAzLjMtMTQyLjQgMy4zek01NzcuOCA2MjNzMCAuMSAwIDB6bS0yNDQuMy0yLjFjMzcuOSAxLjYgMjA2LjYgMS42IDI0NC41IDBsLjMtMTE1IC4zLTE1Ni4yaDEzMWMtMjcuNC0zMS4zLTcxLTgwLjEtMTEzLjUtMTI3LjdDNTE2LjMgMTMyLjggNDY4LjggNzkuOSA0NTUgNjYuMiA0MjcuNiA5NiAyNjUuNSAyNzcuNCAyMDEuNCAzNDkuN2gxMzEuM0wzMzMgNTA2bC41IDExNC45eiIvPjwvc3ZnPg==",shift_perm:"5MTEuMyA4MzMuNCI+PHBhdGggZD0iTTQ1NS41IDY4Ny44Yy0zMy43IDAtNjUuNC0uMi04OS40LS41LTQ1LjItLjYtNDguMi0xLjQtNTIuOC0yLjgtMTcuMy00LjktMzIuMS0xNy45LTM5LjYtMzQuN0wyNjggNjM3bC0uNC0xMzAuNy0uMi05MUgyMjljLTQxLjYgMC02MC42IDAtNzIuNC0xLjEtMTQtMS4zLTI5LjYtNS4xLTM5LjQtMjQuMS01LjktMTEuMy05LjUtMjkuNCA3LTUxLjJsLjEtLjJjNi4xLTggMTEzLjEtMTI3LjcgMTQ1LjctMTY0LjIgMzYuNS00MC44IDcwLjYtNzguOSA5Ni4yLTEwNy40IDQ1LjctNTAuOSA0Ni40LTUxLjQgNDkuNS01My44bC41LS40YzUuOC00LjMgMTMuMy03LjggMTgtOS41bC41LS4yYzE2LjktNS43IDM3LjItMy42IDUzLjEgNS40bC4xLjFDNDk3LjEgMTQgNDk5IDE1IDY0NSAxNzguNWM1NS4yIDYxLjcgODkuNiAxMDAuNSAxMTEuOCAxMjUuOCAzNS40IDQwLjQgMzYuNiA0Mi45IDM5IDQ5LjMgOC44IDIyLjgtLjUgNDYtMjIuOCA1Ni40bC0uOS40Yy0xMS41IDQuOS0xNy40IDQuOS04OS4zIDQuOUg2NDRsLS4yIDkxLS41IDEzMC43LTUuNyAxMi43Yy03LjQgMTYuOC0yMi4zIDI5LjgtMzkuNyAzNC44LTUuMiAxLjUtMTIgMy4zLTE0Mi40IDMuM3ptMTIyLjItNjQuNXMwIC4xIDAgMHoiLz48cGF0aCBkPSJNMzAzLjggNzk3LjRoMzA0IiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iNzIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIi8+PC9zdmc+",shift_down:"5MTEuMyA2ODcuNSI+PHBhdGggZD0iTTQ1NS42IDY4Ny41Yy0zMy43IDAtNjUuNC0uMi04OS40LS41LTQ1LjItLjYtNDguMi0xLjQtNTIuOC0yLjgtMTcuMy00LjktMzIuMS0xNy45LTM5LjYtMzQuN2wtNS44LTEyLjgtLjMtMTMwLjctLjItOTFoLTM4LjRjLTQxLjYgMC02MC42IDAtNzIuNC0xLjEtMTQtMS4zLTI5LjYtNS4xLTM5LjQtMjQuMS01LjktMTEuMy05LjUtMjkuNCA3LTUxLjJsLjEtLjJjNi4xLTggMTEzLjEtMTI3LjcgMTQ1LjctMTY0LjIgMzYuNS00MC44IDcwLjYtNzguOSA5Ni4yLTEwNy40QzQxMiAxNS45IDQxMi42IDE1LjQgNDE1LjggMTNsLjUtLjRjNS44LTQuMyAxMy4zLTcuOCAxOC05LjVsLjUtLjJjMTYuOS01LjcgMzcuMi0zLjYgNTMuMSA1LjRsLjEuMWM5LjIgNS4zIDExLjEgNi4zIDE1Ny4xIDE2OS44IDU1LjIgNjEuNyA4OS42IDEwMC41IDExMS44IDEyNS44IDM1LjQgNDAuNCAzNi42IDQyLjkgMzkgNDkuMyA4LjggMjIuOC0uNSA0Ni0yMi44IDU2LjRsLS45LjRjLTExLjUgNC45LTE3LjQgNC45LTg5LjMgNC45SDY0NGwtLjIgOTEtLjQgMTMwLjctNS43IDEyLjdjLTcuNCAxNi44LTIyLjMgMjkuOC0zOS43IDM0LjgtNS4yIDEuNS0xMiAzLjMtMTQyLjQgMy4zek01NzcuOCA2MjNzMCAuMSAwIDB6Ii8+PC9zdmc+",enter:"xMDAwIDY4Ny41Ij48cGF0aCBkPSJNODgxLjIgMHYzMzIuNUgzNDUuOVY5NS43TC0uMyAzOTEuN2wzNDYuMiAyOTUuOFY0NTAuN2g1OTQuNWMzMi43IDAgNTkuMi0yNi41IDU5LjItNTkuMlYwSDg4MS4yeiIvPjwvc3ZnPg==",lang:"5MTEuMyA2ODMuNSI+PHBhdGggZD0iTTQ1Ni4yLjhjLTE4OC4yIDAtMzQwLjYgMTUyLjgtMzQwLjYgMzQxczE1Mi40IDM0MSAzNDAuNiAzNDFjMTg4LjYgMCAzNDEuMy0xNTIuOCAzNDEuMy0zNDFTNjQ0LjguOCA0NTYuMi44em0yMzYuMyAyMDQuNkg1OTEuOWMtMTAuOS00Mi43LTI2LjYtODMuNi00Ny0xMjEuNCA2Mi43IDIxLjQgMTE0LjkgNjUuMSAxNDcuNiAxMjEuNHpNNDU2LjYgNzAuM2MyOC4zIDQwLjkgNTAuNSA4Ni4zIDY1LjEgMTM1SDM5MS40YzE0LjctNDguNyAzNi44LTk0LjEgNjUuMi0xMzV6bS0yNjQgMzM5LjZjLTUuNS0yMS44LTguOS00NC43LTguOS02OC4yczMuNC00Ni40IDguOS02OC4yaDExNS4zYy0yLjcgMjIuNS00LjggNDUtNC44IDY4LjJzMiA0NS43IDQuOCA2OC4ySDE5Mi42em0yOCA2OC4yaDEwMC42YzEwLjkgNDIuNiAyNi42IDgzLjUgNDcuMSAxMjEuNC02Mi44LTIxLjQtMTE1LTY0LjgtMTQ3LjctMTIxLjR6bTEwMC42LTI3Mi43SDIyMC42YzMyLjctNTYuNiA4NC45LTk5LjkgMTQ3LjYtMTIxLjQtMjAuNCAzNy44LTM2LjEgNzguNy00NyAxMjEuNHptMTM1LjQgNDA3LjhjLTI4LjMtNDAuOS01MC41LTg2LjMtNjUuMS0xMzVoMTMwLjNjLTE0LjggNDguNy0zNi45IDk0LjEtNjUuMiAxMzV6bTc5LjctMjAzLjNIMzc2LjhjLTMuMS0yMi41LTUuNS00NS01LjUtNjguMnMyLjQtNDYgNS41LTY4LjJoMTU5LjZjMy4xIDIyLjIgNS41IDQ1IDUuNSA2OC4ycy0yLjUgNDUuNy01LjYgNjguMnptOC42IDE4OS42YzIwLjUtMzcuOCAzNi4xLTc4LjggNDcuMS0xMjEuNGgxMDAuNmMtMzIuOCA1Ni4zLTg1IDEwMC0xNDcuNyAxMjEuNHptNjAuMy0xODkuNmMyLjctMjIuNSA0LjgtNDUgNC44LTY4LjJzLTItNDUuNy00LjgtNjguMmgxMTUuM2M1LjUgMjEuOCA4LjkgNDQuNyA4LjkgNjguMnMtMy40IDQ2LjQtOC45IDY4LjJINjA1LjJ6Ii8+PC9zdmc+",cached:{}},M=()=>{const a=Object.keys(e).filter(a=>!1===["cached"].includes(a)),r=[];return a.forEach(a=>{r.push((a=>new Promise(r=>{if(e.cached[a])return r(e.cached[a]);const c=new Image;c.src="".concat("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA").concat(e[a]),c.onload=()=>{e.cached[a]=c,r(c)}}))(a))}),Promise.all(r)},L=(a,r,M,L,j,u)=>{const o=e.cached[u];if(!o)return;const l=o.width/o.height;t.clearRect(0,0,h.width,h.height),h.width=c.fontSize*c.resolution*1.5,h.height=h.width/l;const i=(L-h.width)/2,N=(j-h.height)/2;t.drawImage(o,0,0,h.width,h.height),t.fillStyle=a.fillStyle;const n=t.globalCompositeOperation;t.globalCompositeOperation="source-in",t.fillRect(0,0,h.width,h.height),t.globalCompositeOperation=n,a.drawImage(h,r+i,M+N,h.width,h.height)};function j(){}Object.assign(j.prototype,{addEventListener:function(a,r){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]),-1===c[a].indexOf(r)&&c[a].push(r)},removeEventListener:function(a,r){if(void 0!==this._listeners){var c=this._listeners[a];if(void 0!==c){var h=c.indexOf(r);-1!==h&&c.splice(h,1)}}},dispatchEvent:function(a){if(void 0!==this._listeners){var r=this._listeners[a.type];if(void 0!==r){a.target=this;for(var c=r.slice(0),h=0,t=c.length;h<t;h++)c[h].call(this,a)}}}});const u=new j,o=(r,c)=>{let h=null;r.length<=2&&!a.includes(r.toLowerCase())&&(h=c?r.toUpperCase():r),"space"===r&&(h=" "),u.dispatchEvent({type:l,key:r,char:h})},l="keyDown";var i=Object.freeze({__proto__:null,dispatcher:u,addEventListener:(a,r)=>{u.addEventListener(a,r)},removeEventListener:(a,r)=>{u.removeEventListener(a,r)},dispatchEvent:o,KEYDOWN:l});const N=document.createElement("canvas"),n=N.getContext("2d"),s={x:0,y:0};let g,x=null,I=null,T=null,y=null,D=null,w=null,S=null,z=null,d=null,A=!1,C=null,E=!1,f=!1,p=0,O=!1,Y=null;const Q=a=>{r[a]&&(T=a,k(a))},k=a=>{D=r[a],w=a,y=ra();const c=(y+1)*S;z=(N.width-c)/y,X()},v=(a,r,c)=>{A=a,void 0!==r?b(r,c):b(s.x,s.y)},U=(a,r)=>{b(N.width*a,N.height*r)},b=(a,r)=>{let c;s.x=a,s.y=r,E&&(c=G()),c||(c=W()),!c&&g&&(V(),X())},m=(a,r,h)=>{c.resolution=h,d=c.buttonHeight*c.resolution,S=c.margin*c.resolution;const t=ta();r=Math.max(r,t),N.width=a*c.resolution,N.height=r*c.resolution,N.style.width="".concat(a,"px"),N.style.height="".concat(r,"px"),w&&k(w)},P=()=>{N.width=512*c.resolution,N.height=N.width/c.aspect,S=c.margin*c.resolution,d=c.buttonHeight*c.resolution,w&&k(w)},R=()=>{const a=(a,r)=>(I=N.getBoundingClientRect(),a-=I.x,r-=I.y,[a*c.resolution,r*c.resolution]);document.addEventListener("mousemove",r=>{b(...a(r.clientX,r.clientY))}),N.addEventListener("mousedown",r=>{v(!0,...a(r.clientX,r.clientY)),r.preventDefault()}),document.addEventListener("mouseup",a=>{v(!1)}),document.addEventListener("touchmove",r=>{const c=r.touches[0];b(...a(c.clientX,c.clientY)),r.preventDefault()},{passive:!1}),N.addEventListener("touchstart",r=>{const c=r.touches[0];v(!0,...a(c.clientX,c.clientY)),r.preventDefault()},{passive:!1}),document.addEventListener("touchend",a=>{v(!1)},{passive:!1})},B=a=>{M().then(()=>{X()}),Object.assign(c,a),T=c.language,P(),Q("en")};let H=!0;const J=a=>{H=a},_=(a,r,c,h,t)=>{c<2*t&&(t=c/2),h<2*t&&(t=h/2),n.beginPath(),n.moveTo(a+t,r),n.arcTo(a+c,r,a+c,r+h,t),n.arcTo(a+c,r+h,a,r+h,t),n.arcTo(a,r+h,a,r,t),n.arcTo(a,r,a+c,r,t),n.closePath(),n.fill()},Z=(a,r,h,t,e,M)=>{if(M||(M=c.fontSize*c.resolution),n.font="".concat(M,"px ").concat(c.font),n.textBaseline="middle",!e)return;const L=(h-n.measureText(e).width)/2,j=t/2;n.fillText(e,a+L,r+j)},X=()=>{const a=aa();n.clearRect(0,0,N.width,N.height),n.shadowBlur=c.keyShadow.shadowBlur,n.shadowOffsetX=c.keyShadow.shadowOffsetX,n.shadowOffsetY=c.keyShadow.shadowOffsetY;let r=a;for(let a=0;a<D.length;a++){const h=D[a];let t=S+ca()+ha(a);for(let a=0;a<h.length;a++){const e=h[a];let M=e.w?e.w:1;n.fillStyle=c.colors.hover,e.down?n.fillStyle=c.colors.down:e.hover?n.fillStyle=c.colors.hover:n.fillStyle=c.colors.idle;let j=z*M;if(j+=(M-1)*S,n.shadowColor=c.keyShadow.shadowColor,_(t,r,j,d,c.buttonRadius*c.resolution),n.shadowColor="transparent",n.fillStyle=c.colors.text,e.pos={x:t,y:r},["shift","bksp","enter","lang"].includes(e.char)){let a=e.char;"shift"===e.char&&f&&(a="shift_down"),"shift"===e.char&&O&&(a="shift_perm"),L(n,t,r,j,d,a)}else{let a=f&&1===e.char.length?e.char.toUpperCase():e.char;if("space"===a&&(a="␣"),Z(t,r,j,d,a),e.alt){const a=.6*c.fontSize*c.resolution;Z(t+j/2-a/2,r-d/2+a,j,d,e.alt,a)}}t+=j+S}r+=d+S}if(n.shadowBlur=c.popupShadow.shadowBlur,n.shadowOffsetX=c.popupShadow.shadowOffsetX,n.shadowOffsetY=c.popupShadow.shadowOffsetY,g&&g.extra&&g.down){const{pos:a}=g,{startX:r,startY:h,keyArr:t,popupWidth:e,popupHeight:M}=ea(a,E?[...g.extra]:[g]);n.fillStyle=c.colors.idle,n.shadowColor=c.popupShadow.shadowColor,_(r,h-d*(t.length-1),e,M,c.buttonRadius*c.resolution),_(a.x,a.y-d,z,2*d,c.buttonRadius*c.resolution),n.shadowColor="transparent";let L=h;for(let a=0;a<t.length;a++){const h=t[a];let e=r;for(let a=0;a<h.length;a++){const r=h[a];r.down?n.fillStyle=c.colors.down:r.hover?n.fillStyle=c.colors.hover:n.fillStyle=c.colors.idle,_(e,L,z,d,c.buttonRadius*c.resolution),n.fillStyle=c.colors.text;const t=f&&r.char.length<=2?r.char.toUpperCase():r.char;Z(e,L,z,d,t),E||Z(e,L+d/2,z,d/2,"..."),e+=z}L-=d}}H=!0},W=()=>{const{x:a,y:r}=s,c=aa(),h=Math.floor((r-c)/(d+S)),t=D[h];if(!t)return;let e=S+ca()+ha(h);for(let r=0;r<t.length;r++){const c=t[r];let h=c.w?c.w:1,M=z*h;M+=(h-1)*S;let L=a>e;if(e+=M+S,L&&a<e-S){if(!g||g!==c||g.down!==A){if(g===c&&g.down&&!A)return F(g);V(),g=c,g.hover=!0,g.down=A,g.down?K():$(),X()}return g}}},G=()=>{if(!g||!g.extra)return;if(!A)return F(x),!0;const{x:a,y:r}=s,{pos:c}=g,{startX:h,startY:t,keyArr:e,popupWidth:M,popupHeight:L}=ea(c,[...g.extra]);let j=null,u=Number.POSITIVE_INFINITY,o=t+d/2;for(let c=0;c<e.length;c++){const t=e[c];let M=h+z/2;for(let c=0;c<t.length;c++){const h=t[c],e=a-M,L=r-o,l=Math.sqrt(e*e+L*L);l<u&&(j=h,u=l),M+=z}o-=d}return x&&x===j&&x.down===A||(q(),x=j,x.hover=!0,x.down=!0,X()),a>h&&a<h+M&&r>t-d*(e.length-1)&&r<t-d*(e.length-1)+L||a>c.x&&a<c.x+z&&r>c.y-d&&r<c.y+d},F=r=>{q(),V(),$();let c=!0;switch(o(r.char,f),r.char){case"abc":k(T);break;case"!?#":case"?123":k("num");break;case"=\\<":k("sym");break;case"1234":k("nump");break;case"shift":!O&&Date.now()-p<300?(f=!0,O=!0,p=0):(f=!f,O=!1,p=Date.now()),c=!1;break;case"lang":for(let r=0;r<a.length;r++)if(a[r]===T){let c=r+1;a[c]||(c=0),Q(a[c]);break}break;default:a.includes(r.char.toLowerCase())?Q(r.char.toLowerCase()):(f&&!O&&(f=!1),c=!1)}return c||X(),r},V=()=>{g&&(g.hover=!1,g.down=!1,g=null)},q=()=>{x&&(x.hover=!1,x.down=!1,x=null)},$=()=>{C&&clearTimeout(C),Y&&clearInterval(Y),E=!1},K=()=>{$(),C=setTimeout(()=>{E=!0,q(),G(),g&&"bksp"===g.char&&(Y=setInterval(()=>{g&&o(g.char)},c.bkspIntervalTime))},c.holdPopupTime)},aa=()=>"center"===c.align?N.height/2-D.length*d*.5:2*d+4*S,ra=()=>{let a=0;for(let r=0;r<D.length;r++){const c=D[r];let h=0;for(let a=0;a<c.length;a++){const r=c[a];h+=r.w?r.w:1}h>a&&(a=h)}return a},ca=()=>{let a=ra();const r=(y-a)/2;return r*z+r*S},ha=a=>{const r=D[a];let c=0;for(let a=0;a<r.length;a++){const h=r[a];c+=h.w?h.w:1}const h=(y-c)/2;return h*z+h*S},ta=()=>(D.length*d+(D.length+1)*S+(2*d+3*S))/c.resolution,ea=(a,r)=>{let c=5;r.length>c&&(c=Math.ceil(r.length/2));const h=new Array(Math.ceil(r.length/c)).fill().map(a=>r.splice(0,c)),t=h[0].length*z,e=h.length*d,M=Math.floor(h[0].length/2)*z;let L=a.x-M;for(h[0].length>1&&h[0].length%2==0&&(L+=z);L<0;)L+=z;for(;L+h[0].length*z>N.width;)L-=z;return{keyArr:h,popupWidth:t,popupHeight:e,startX:L,startY:a.y-d-3*S}};export{g as activeElement,R as addListeners,N as canvas,i as events,B as init,Q as selectLanguage,k as setLayout,v as setMouseDown,b as setMousePos,U as setMousePosFromUV,P as setScreenSizeFromAspectRatio,m as setScreenSizeInPixels,J as setTextureDirty,H as textureDirty};
