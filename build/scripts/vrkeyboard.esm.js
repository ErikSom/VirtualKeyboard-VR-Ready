const a=["en","fr","es","ru"],r={en:[[{char:"q",extra:[{char:"1"}],alt:"1"},{char:"w",extra:[{char:"2"}],alt:"2"},{char:"e",extra:[{char:"è"},{char:"3"},{char:"é"},{char:"ê"},{char:"ę"},{char:"ë"},{char:"ē"},{char:"ė"}],alt:"3"},{char:"r",extra:[{char:"4"}],alt:"4"},{char:"t",extra:[{char:"5"}],alt:"5"},{char:"y",extra:[{char:"ý"},{char:"6"},{char:"ĳ"},{char:"ÿ"}],alt:"6"},{char:"u",extra:[{char:"û"},{char:"7"},{char:"ú"},{char:"ū"},{char:"ü"},{char:"ù"}],alt:"7"},{char:"i",extra:[{char:"î"},{char:"8"},{char:"í"},{char:"ï"},{char:"į"},{char:"ī"},{char:"ì"},{char:"ĳ"}],alt:"8"},{char:"o",extra:[{char:"ò"},{char:"ö"},{char:"ô"},{char:"9"},{char:"ó"},{char:"õ"},{char:"ō"},{char:"œ"},{char:"ø"}],alt:"9"},{char:"p",extra:[{char:"0"}],alt:"0"}],[{char:"a",extra:[{char:"à"},{char:"á"},{char:"â"},{char:"ä"},{char:"æ"},{char:"ã"},{char:"å"},{char:"ā"},{char:"ª"}]},{char:"s",extra:[{char:"ß"}]},{char:"d"},{char:"f"},{char:"g"},{char:"h"},{char:"j",extra:[{char:"j́"}]},{char:"k"},{char:"l"}],[{char:"shift",w:1.5},{char:"z"},{char:"x"},{char:"c",extra:[{char:"ç"}]},{char:"v"},{char:"b"},{char:"n",extra:[{char:"ñ"},{char:"ń"}]},{char:"m"},{char:"bksp",w:1.5}],[{char:"?123",w:2},{char:","},{char:"lang"},{char:"space",w:3},{char:"."},{char:"enter",w:2}]],fr:[[{char:"a",extra:[{char:"à"},{char:"á"},{char:"1"},{char:"â"},{char:"ä"},{char:"æ"},{char:"ã"},{char:"å"},{char:"ā"},{char:"ª"}],alt:"1"},{char:"z",extra:[{char:"2"}],alt:"2"},{char:"e",extra:[{char:"è"},{char:"3"},{char:"é"},{char:"ê"},{char:"ę"},{char:"ë"},{char:"ē"},{char:"ė"}],alt:"3"},{char:"r",extra:[{char:"4"}],alt:"4"},{char:"t",extra:[{char:"5"}],alt:"5"},{char:"y",extra:[{char:"ý"},{char:"6"},{char:"ĳ"},{char:"ÿ"}],alt:"6"},{char:"u",extra:[{char:"û"},{char:"7"},{char:"ú"},{char:"ū"},{char:"ü"},{char:"ù"}],alt:"7"},{char:"i",extra:[{char:"î"},{char:"8"},{char:"í"},{char:"ï"},{char:"į"},{char:"ī"},{char:"ì"},{char:"ĳ"}],alt:"8"},{char:"o",extra:[{char:"ò"},{char:"ö"},{char:"ô"},{char:"9"},{char:"ó"},{char:"õ"},{char:"ō"},{char:"œ"},{char:"ø"}],alt:"9"},{char:"p",extra:[{char:"0"}],alt:"0"}],[{char:"q"},{char:"s",extra:[{char:"ß"}]},{char:"d"},{char:"f"},{char:"g"},{char:"h"},{char:"j",extra:[{char:"j́"}]},{char:"k"},{char:"l"},{char:"m"}],[{char:"shift",w:1.5},{char:"w"},{char:"x"},{char:"c",extra:[{char:"ç"}]},{char:"v"},{char:"b"},{char:"n",extra:[{char:"ñ"},{char:"ń"}]},{char:"'",extra:[{char:"‚"},{char:"‘"},{char:"’"},{char:"‹"},{char:"›"}]},{char:"bksp",w:1.5}],[{char:"?123",w:2},{char:","},{char:"lang"},{char:"space",w:3},{char:"."},{char:"enter",w:2}]],es:[[{char:"q",extra:[{char:"1"}],alt:"1"},{char:"w",extra:[{char:"2"}],alt:"2"},{char:"e",extra:[{char:"è"},{char:"3"},{char:"é"},{char:"ê"},{char:"ę"},{char:"ë"},{char:"ē"},{char:"ė"}],alt:"3"},{char:"r",extra:[{char:"4"}],alt:"4"},{char:"t",extra:[{char:"5"}],alt:"5"},{char:"y",extra:[{char:"ý"},{char:"6"},{char:"ĳ"},{char:"ÿ"}],alt:"6"},{char:"u",extra:[{char:"û"},{char:"7"},{char:"ú"},{char:"ū"},{char:"ü"},{char:"ù"}],alt:"7"},{char:"i",extra:[{char:"î"},{char:"8"},{char:"í"},{char:"ï"},{char:"į"},{char:"ī"},{char:"ì"},{char:"ĳ"}],alt:"8"},{char:"o",extra:[{char:"ò"},{char:"ö"},{char:"ô"},{char:"9"},{char:"ó"},{char:"õ"},{char:"ō"},{char:"œ"},{char:"ø"}],alt:"9"},{char:"p",extra:[{char:"0"}],alt:"0"}],[{char:"a",extra:[{char:"à"},{char:"á"},{char:"â"},{char:"ä"},{char:"æ"},{char:"ã"},{char:"å"},{char:"ā"},{char:"ª"}]},{char:"s",extra:[{char:"ß"}]},{char:"d"},{char:"f"},{char:"g"},{char:"h"},{char:"j",extra:[{char:"j́"}]},{char:"k"},{char:"l"},{char:"ñ"}],[{char:"shift",w:1.5},{char:"z"},{char:"x"},{char:"c",extra:[{char:"ç"}]},{char:"v"},{char:"b"},{char:"n",extra:[{char:"ñ"},{char:"ń"}]},{char:"m"},{char:"bksp",w:1.5}],[{char:"?123",w:2},{char:","},{char:"lang"},{char:"space",w:3},{char:"."},{char:"enter",w:2}]],ru:[[{char:"й",extra:[{char:"1"}],alt:"1"},{char:"ц",extra:[{char:"2"}],alt:"2"},{char:"у",extra:[{char:"3"},{char:"у́"}],alt:"3"},{char:"к",extra:[{char:"4"}],alt:"4"},{char:"е",extra:[{char:"е́"},{char:"5"},{char:"ё"}],alt:"5"},{char:"н",extra:[{char:"6"}],alt:"6"},{char:"г",extra:[{char:"7"},{char:"ґ"}],alt:"7"},{char:"ш",extra:[{char:"8"}],alt:"8"},{char:"щ",extra:[{char:"9"}],alt:"9"},{char:"з",extra:[{char:"0"}],alt:"0"},{char:"х"}],[{char:"ф"},{char:"ы",extra:[{char:"ы́"}]},{char:"в"},{char:"а",extra:[{char:"а́"}]},{char:"п"},{char:"р"},{char:"о",extra:[{char:"о́"}]},{char:"л"},{char:"д"},{char:"ж"},{char:"э",extra:[{char:"є"},{char:"э́"}]}],[{char:"shift"},{char:"я",extra:[{char:"я́"}]},{char:"ч"},{char:"с"},{char:"м"},{char:"и",extra:[{char:"ї"},{char:"и́"},{char:"і"}]},{char:"т"},{char:"ь",extra:[{char:"ъ"}]},{char:"б"},{char:"ю",extra:[{char:"ю́"}]},{char:"bksp"}],[{char:"?123",w:2},{char:","},{char:"lang"},{char:"space",w:4},{char:"."},{char:"enter",w:2}]],num:[[{char:"1",extra:[{char:"¹"},{char:"½"},{char:"⅓"},{char:"¼"},{char:"⅕"},{char:"⅙"},{char:"⅐"},{char:"⅛"},{char:"⅑"},{char:"⅒"}]},{char:"2",extra:[{char:"⅖"},{char:"²"},{char:"⅔"}]},{char:"3",extra:[{char:"⅗"},{char:"³"},{char:"¾"},{char:"⅜"}]},{char:"4",extra:[{char:"⁴"},{char:"⅘"}]},{char:"5",extra:[{char:"⅝"},{char:"⁵"},{char:"⅚"}]},{char:"6",extra:[{char:"⁶"}]},{char:"7",extra:[{char:"⁷"},{char:"⅞"}]},{char:"8",extra:[{char:"⁸"}]},{char:"9",extra:[{char:"⁹"}]},{char:"0",extra:[{char:"∅"},{char:"ⁿ"},{char:"⁰"}]}],[{char:"@"},{char:"#",extra:[{char:"№"}]},{char:"$",extra:[{char:"₱"},{char:"€"},{char:"¢"},{char:"£"},{char:"¥"}]},{char:"_"},{char:"&"},{char:"-",extra:[{char:"—"},{char:"_"},{char:"–"},{char:"·"}]},{char:"+",extra:[{char:"±"}]},{char:"(",extra:[{char:"["},{char:"<"},{char:"{"}]},{char:")",extra:[{char:"]"},{char:">"},{char:"}"}]},{char:"/"}],[{char:"=\\<",w:1.5},{char:"*",extra:[{char:"★"},{char:"†"},{char:"‡"}]},{char:'"',extra:[{char:"„"},{char:"“"},{char:"”"},{char:"«"},{char:"»"}]},{char:"'",extra:[{char:"‚"},{char:"‘"},{char:"’"},{char:"‹"},{char:"›"}]},{char:":"},{char:";"},{char:"!",extra:[{char:"¡"}]},{char:"?",extra:[{char:"¿"},{char:"‽"}]},{char:"bksp",w:1.5}],[{char:"abc",w:1.5},{char:","},{char:"1234"},{char:"space",w:4},{char:"."},{char:"enter",w:1.5}]],nump:[[{char:"+",extra:[{char:"-"}]},{char:"1",w:2},{char:"2",w:2},{char:"3",w:2},{char:"%"}],[{char:"*"},{char:"4",w:2},{char:"5",w:2},{char:"6",w:2},{char:"space"}],[{char:"/"},{char:"7",w:2},{char:"8",w:2},{char:"9",w:2},{char:"bksp"}],[{char:"abc"},{char:","},{char:"!?#"},{char:"0",w:2},{char:"="},{char:"."},{char:"enter"}]],sym:[[{char:"〜"},{char:"`"},{char:"|"},{char:"•",extra:[{char:"♣"},{char:"♠"},{char:"♪"},{char:"♥"},{char:"♦"}]},{char:"√"},{char:"π",extra:[{char:"Ω"},{char:"Π"},{char:"μ"}]},{char:"÷"},{char:"×"},{char:"¶",extra:["§"]},{char:"Δ"}],[{char:"£"},{char:"€"},{char:"$",extra:[{char:"₱"},{char:"€"},{char:"¢"},{char:"£"},{char:"¥"}]},{char:"¢"},{char:"^",extra:[{char:"←"},{char:"↑"},{char:"↓"},{char:"→"}]},{char:"°",extra:[{char:"′"},{char:"″"}]},{char:"=",extra:[{char:"∞"},{char:"≠"},{char:"≈"}]},{char:"{",extra:[{char:"("}]},{char:"}",extra:[{char:")"}]},{char:"\\"}],[{char:"?123",w:1.5},{char:"%",extra:[{char:"‰"},{char:"℅"}]},{char:"©"},{char:"®"},{char:"™"},{char:"✓"},{char:"["},{char:"]"},{char:"bksp",w:1.5}],[{char:"abc",w:1.5},{char:"<"},{char:"space",w:5},{char:">"},{char:"enter",w:1.5}]]};a.forEach(c=>{const t=r[c][3][2];t.extra=[],a.forEach(a=>{t.extra.push({char:a.toUpperCase()})})});const c={resolution:1,aspect:1.25,margin:5,fontSize:16,buttonHeight:40,buttonRadius:5,language:"en",font:"sans-serif",align:"center",swipe:!0,colors:{idle:"#3f4a52",hover:"#2d343a",down:"#5cb0a7",text:"#ffffff"},keyShadow:{shadowColor:"rgba(0, 0, 0, .3)",shadowBlur:1,shadowOffsetX:1,shadowOffsetY:1},popupShadow:{shadowColor:"rgba(0, 0, 0, .3)",shadowBlur:4,shadowOffsetX:0,shadowOffsetY:2},holdPopupTime:300,bkspIntervalTime:50},t=document.createElement("canvas"),h=t.getContext("2d"),e={bksp:"5MTEuMyA2ODMuNSI+PHBhdGggZD0iTTgzNS40IDBIMjY1LjhjLTI2LjIgMC00Ni43IDEzLjMtNjAuNCAzMy40TDAgMzQxLjhsMjA1LjQgMzA4YzEzLjcgMjAuMSAzNC4yIDMzLjggNjAuNCAzMy44aDU2OS42YzQxLjggMCA3NS45LTM0LjIgNzUuOS03NS45Vjc1LjljMC00MS43LTM0LjEtNzUuOS03NS45LTc1Ljl6bTAgNjA3LjZIMjY4LjVMOTEuMSAzNDEuOCAyNjguMSA3Nmg1NjcuM3Y1MzEuNnptLTQ0MC4xLTc2bDEzNi4zLTEzNi4zIDEzNi4zIDEzNi4zIDUzLjUtNTMuNS0xMzYuMi0xMzYuMyAxMzYuMy0xMzYuM0w2NjggMTUyIDUzMS42IDI4OC4yIDM5NS4zIDE1MS45bC01My41IDUzLjUgMTM2LjMgMTM2LjMtMTM2LjMgMTM2LjQgNTMuNSA1My41eiIvPjwvc3ZnPg==",shift:"5MTEuMyA2ODcuNSI+PHBhdGggZD0iTTQ1NS42IDY4Ny41Yy0zMy43IDAtNjUuNC0uMi04OS40LS41LTQ1LjItLjYtNDguMi0xLjQtNTIuOC0yLjgtMTcuMy00LjktMzIuMS0xNy45LTM5LjYtMzQuN2wtNS44LTEyLjgtLjMtMTMwLjctLjItOTFoLTM4LjRjLTQxLjYgMC02MC42IDAtNzIuNC0xLjEtMTQtMS4zLTI5LjYtNS4xLTM5LjQtMjQuMS01LjktMTEuMy05LjUtMjkuNCA3LTUxLjJsLjEtLjJjNi4xLTggMTEzLjEtMTI3LjcgMTQ1LjctMTY0LjIgMzYuNS00MC44IDcwLjYtNzguOSA5Ni4yLTEwNy40QzQxMiAxNS45IDQxMi42IDE1LjQgNDE1LjggMTNsLjUtLjRjNS44LTQuMyAxMy4zLTcuOCAxOC05LjVsLjUtLjJjMTYuOS01LjcgMzcuMi0zLjYgNTMuMSA1LjRsLjEuMWM5LjIgNS4zIDExLjEgNi4zIDE1Ny4xIDE2OS44IDU1LjIgNjEuNyA4OS42IDEwMC41IDExMS44IDEyNS44IDM1LjQgNDAuNCAzNi42IDQyLjkgMzkgNDkuMyA4LjggMjIuOC0uNSA0Ni0yMi44IDU2LjRsLS45LjRjLTExLjUgNC45LTE3LjQgNC45LTg5LjMgNC45SDY0NGwtLjIgOTEtLjQgMTMwLjctNS43IDEyLjdjLTcuNCAxNi44LTIyLjMgMjkuOC0zOS43IDM0LjgtNS4yIDEuNS0xMiAzLjMtMTQyLjQgMy4zek01NzcuOCA2MjNzMCAuMSAwIDB6bS0yNDQuMy0yLjFjMzcuOSAxLjYgMjA2LjYgMS42IDI0NC41IDBsLjMtMTE1IC4zLTE1Ni4yaDEzMWMtMjcuNC0zMS4zLTcxLTgwLjEtMTEzLjUtMTI3LjdDNTE2LjMgMTMyLjggNDY4LjggNzkuOSA0NTUgNjYuMiA0MjcuNiA5NiAyNjUuNSAyNzcuNCAyMDEuNCAzNDkuN2gxMzEuM0wzMzMgNTA2bC41IDExNC45eiIvPjwvc3ZnPg==",shift_perm:"5MTEuMyA4MzMuNCI+PHBhdGggZD0iTTQ1NS41IDY4Ny44Yy0zMy43IDAtNjUuNC0uMi04OS40LS41LTQ1LjItLjYtNDguMi0xLjQtNTIuOC0yLjgtMTcuMy00LjktMzIuMS0xNy45LTM5LjYtMzQuN0wyNjggNjM3bC0uNC0xMzAuNy0uMi05MUgyMjljLTQxLjYgMC02MC42IDAtNzIuNC0xLjEtMTQtMS4zLTI5LjYtNS4xLTM5LjQtMjQuMS01LjktMTEuMy05LjUtMjkuNCA3LTUxLjJsLjEtLjJjNi4xLTggMTEzLjEtMTI3LjcgMTQ1LjctMTY0LjIgMzYuNS00MC44IDcwLjYtNzguOSA5Ni4yLTEwNy40IDQ1LjctNTAuOSA0Ni40LTUxLjQgNDkuNS01My44bC41LS40YzUuOC00LjMgMTMuMy03LjggMTgtOS41bC41LS4yYzE2LjktNS43IDM3LjItMy42IDUzLjEgNS40bC4xLjFDNDk3LjEgMTQgNDk5IDE1IDY0NSAxNzguNWM1NS4yIDYxLjcgODkuNiAxMDAuNSAxMTEuOCAxMjUuOCAzNS40IDQwLjQgMzYuNiA0Mi45IDM5IDQ5LjMgOC44IDIyLjgtLjUgNDYtMjIuOCA1Ni40bC0uOS40Yy0xMS41IDQuOS0xNy40IDQuOS04OS4zIDQuOUg2NDRsLS4yIDkxLS41IDEzMC43LTUuNyAxMi43Yy03LjQgMTYuOC0yMi4zIDI5LjgtMzkuNyAzNC44LTUuMiAxLjUtMTIgMy4zLTE0Mi40IDMuM3ptMTIyLjItNjQuNXMwIC4xIDAgMHoiLz48cGF0aCBkPSJNMzAzLjggNzk3LjRoMzA0IiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iNzIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIi8+PC9zdmc+",shift_down:"5MTEuMyA2ODcuNSI+PHBhdGggZD0iTTQ1NS42IDY4Ny41Yy0zMy43IDAtNjUuNC0uMi04OS40LS41LTQ1LjItLjYtNDguMi0xLjQtNTIuOC0yLjgtMTcuMy00LjktMzIuMS0xNy45LTM5LjYtMzQuN2wtNS44LTEyLjgtLjMtMTMwLjctLjItOTFoLTM4LjRjLTQxLjYgMC02MC42IDAtNzIuNC0xLjEtMTQtMS4zLTI5LjYtNS4xLTM5LjQtMjQuMS01LjktMTEuMy05LjUtMjkuNCA3LTUxLjJsLjEtLjJjNi4xLTggMTEzLjEtMTI3LjcgMTQ1LjctMTY0LjIgMzYuNS00MC44IDcwLjYtNzguOSA5Ni4yLTEwNy40QzQxMiAxNS45IDQxMi42IDE1LjQgNDE1LjggMTNsLjUtLjRjNS44LTQuMyAxMy4zLTcuOCAxOC05LjVsLjUtLjJjMTYuOS01LjcgMzcuMi0zLjYgNTMuMSA1LjRsLjEuMWM5LjIgNS4zIDExLjEgNi4zIDE1Ny4xIDE2OS44IDU1LjIgNjEuNyA4OS42IDEwMC41IDExMS44IDEyNS44IDM1LjQgNDAuNCAzNi42IDQyLjkgMzkgNDkuMyA4LjggMjIuOC0uNSA0Ni0yMi44IDU2LjRsLS45LjRjLTExLjUgNC45LTE3LjQgNC45LTg5LjMgNC45SDY0NGwtLjIgOTEtLjQgMTMwLjctNS43IDEyLjdjLTcuNCAxNi44LTIyLjMgMjkuOC0zOS43IDM0LjgtNS4yIDEuNS0xMiAzLjMtMTQyLjQgMy4zek01NzcuOCA2MjNzMCAuMSAwIDB6Ii8+PC9zdmc+",enter:"xMDAwIDY4Ny41Ij48cGF0aCBkPSJNODgxLjIgMHYzMzIuNUgzNDUuOVY5NS43TC0uMyAzOTEuN2wzNDYuMiAyOTUuOFY0NTAuN2g1OTQuNWMzMi43IDAgNTkuMi0yNi41IDU5LjItNTkuMlYwSDg4MS4yeiIvPjwvc3ZnPg==",lang:"5MTEuMyA2ODMuNSI+PHBhdGggZD0iTTQ1Ni4yLjhjLTE4OC4yIDAtMzQwLjYgMTUyLjgtMzQwLjYgMzQxczE1Mi40IDM0MSAzNDAuNiAzNDFjMTg4LjYgMCAzNDEuMy0xNTIuOCAzNDEuMy0zNDFTNjQ0LjguOCA0NTYuMi44em0yMzYuMyAyMDQuNkg1OTEuOWMtMTAuOS00Mi43LTI2LjYtODMuNi00Ny0xMjEuNCA2Mi43IDIxLjQgMTE0LjkgNjUuMSAxNDcuNiAxMjEuNHpNNDU2LjYgNzAuM2MyOC4zIDQwLjkgNTAuNSA4Ni4zIDY1LjEgMTM1SDM5MS40YzE0LjctNDguNyAzNi44LTk0LjEgNjUuMi0xMzV6bS0yNjQgMzM5LjZjLTUuNS0yMS44LTguOS00NC43LTguOS02OC4yczMuNC00Ni40IDguOS02OC4yaDExNS4zYy0yLjcgMjIuNS00LjggNDUtNC44IDY4LjJzMiA0NS43IDQuOCA2OC4ySDE5Mi42em0yOCA2OC4yaDEwMC42YzEwLjkgNDIuNiAyNi42IDgzLjUgNDcuMSAxMjEuNC02Mi44LTIxLjQtMTE1LTY0LjgtMTQ3LjctMTIxLjR6bTEwMC42LTI3Mi43SDIyMC42YzMyLjctNTYuNiA4NC45LTk5LjkgMTQ3LjYtMTIxLjQtMjAuNCAzNy44LTM2LjEgNzguNy00NyAxMjEuNHptMTM1LjQgNDA3LjhjLTI4LjMtNDAuOS01MC41LTg2LjMtNjUuMS0xMzVoMTMwLjNjLTE0LjggNDguNy0zNi45IDk0LjEtNjUuMiAxMzV6bTc5LjctMjAzLjNIMzc2LjhjLTMuMS0yMi41LTUuNS00NS01LjUtNjguMnMyLjQtNDYgNS41LTY4LjJoMTU5LjZjMy4xIDIyLjIgNS41IDQ1IDUuNSA2OC4ycy0yLjUgNDUuNy01LjYgNjguMnptOC42IDE4OS42YzIwLjUtMzcuOCAzNi4xLTc4LjggNDcuMS0xMjEuNGgxMDAuNmMtMzIuOCA1Ni4zLTg1IDEwMC0xNDcuNyAxMjEuNHptNjAuMy0xODkuNmMyLjctMjIuNSA0LjgtNDUgNC44LTY4LjJzLTItNDUuNy00LjgtNjguMmgxMTUuM2M1LjUgMjEuOCA4LjkgNDQuNyA4LjkgNjguMnMtMy40IDQ2LjQtOC45IDY4LjJINjA1LjJ6Ii8+PC9zdmc+",cached:{}},M=()=>{const a=Object.keys(e).filter(a=>!1===["cached"].includes(a)),r=[];return a.forEach(a=>{r.push((a=>new Promise(r=>{if(e.cached[a])return r(e.cached[a]);const c=new Image;c.src="".concat("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA").concat(e[a]),c.onload=()=>{e.cached[a]=c,r(c)}}))(a))}),Promise.all(r)},l=(a,r,M,l,o,n)=>{const u=e.cached[n];if(!u)return;const j=u.width/u.height;h.clearRect(0,0,t.width,t.height),t.width=c.fontSize*c.resolution*1.5,t.height=t.width/j;const L=(l-t.width)/2,i=(o-t.height)/2;h.drawImage(u,0,0,t.width,t.height),h.fillStyle=a.fillStyle;const s=h.globalCompositeOperation;h.globalCompositeOperation="source-in",h.fillRect(0,0,t.width,t.height),h.globalCompositeOperation=s,a.drawImage(t,r+L,M+i,t.width,t.height)};function o(){}Object.assign(o.prototype,{addEventListener:function(a,r){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]),-1===c[a].indexOf(r)&&c[a].push(r)},removeEventListener:function(a,r){if(void 0!==this._listeners){var c=this._listeners[a];if(void 0!==c){var t=c.indexOf(r);-1!==t&&c.splice(t,1)}}},dispatchEvent:function(a){if(void 0!==this._listeners){var r=this._listeners[a.type];if(void 0!==r){a.target=this;for(var c=r.slice(0),t=0,h=c.length;t<h;t++)c[t].call(this,a)}}}});const n=new o,u=(r,c)=>{let t=null;r.length<=2&&!a.includes(r.toLowerCase())&&(t=c?r.toUpperCase():r),"space"===r&&(t=" "),n.dispatchEvent({type:j,key:r,char:t})},j="keyDown";var L=Object.freeze({__proto__:null,dispatcher:n,addEventListener:(a,r)=>{n.addEventListener(a,r)},removeEventListener:(a,r)=>{n.removeEventListener(a,r)},dispatchEvent:u,KEYDOWN:j});const i={};let s=!1;const N=Math.PI/4;let g,x=[],I=[],T=[],y=[],w=null,D=null,S=null;const d=a=>{const r=a.toString().split("\n");for(let a=0;a<r.length;a++){const c=r[a].replace("\r","");let t=null,h=null;const e=Math.min(c.length,8);for(let a=0;a<e;a++){const r=c.charAt(a);r!==h&&(null===t?(void 0===i[g][r]&&(i[g][r]={}),t=i[g][r]):(void 0===t[r]&&(t[r]={}),t=t[r])),h=r,a===e-1&&(void 0===t.words&&(t.words=[]),t.words.push(c))}}},z=(a,r,c)=>{a&&x[x.length-1]!==a.char&&a.char.length<=2&&(x.push(a.char),Y(),A(a.char))},A=a=>{if(0===I.length){const r=i[g][a];C(r)}else T=[],I.forEach(r=>{if(r){const c=r[a];C(c)}});return y},C=a=>{if(!a)return;Object.keys(a).filter(a=>"words"!==a).length>0&&(I.push(a),T.push(a)),f(a)},f=a=>{const{words:r}=a;r&&(y=y.concat(r))},E=(a,r)=>{let c=x[x.length-1];if(w&&S!==c){const t=a-w.x,h=r-w.y;if(Math.sqrt(t*t+h*h)>=2){let e=Math.atan2(h,t);if(D){const a=p(e,D);Math.abs(a)>N&&(I=[...T],T=[],S=c)}D=e,w={x:a,y:r}}}w||(w={x:a,y:r})},p=(a,r)=>Math.atan2(Math.sin(a-r),Math.cos(a-r)),O=()=>{const a=x[x.length-1],r=y.filter(r=>r.charAt(r.length-1)===a);return r.sort((function(a,r){return r.length-a.length})),r},Y=()=>{w=null,D=null,S=null},Q=()=>{x=[],I=[],T=[],y=[],Y()},k=document.createElement("canvas"),v=k.getContext("2d"),U={x:0,y:0};let b,m=null,P=null,R=null,B=null,H=null,J=null,_=null,Z=null,X=null,W=!1,G=null,F=!1,V=!1,q=0,$=!1,K=null;const aa=a=>{r[a]&&(R=a,ra(a))},ra=a=>{H=r[a],J=a,B=Da();const c=(B+1)*_;Z=(k.width-c)/B,ia()},ca=(a,r,c)=>{W=a,void 0!==r?ha(r,c):ha(U.x,U.y),W||(a=>{if(s){z(a);const r=O();return Q(),r}})(b)},ta=(a,r)=>{ha(k.width*a,k.height*r)},ha=(a,r)=>{let c;U.x=a,U.y=r,F&&(c=Na()),c||(c=sa()),W&&((a,r,c)=>{s&&(a&&E(r,c),z(a))})(b,a,r),!c&&b&&(xa(),ia())},ea=(a,r,t)=>{c.resolution=t,X=c.buttonHeight*c.resolution,_=c.margin*c.resolution;const h=za();r=Math.max(r,h),k.width=a*c.resolution,k.height=r*c.resolution,k.style.width="".concat(a,"px"),k.style.height="".concat(r,"px"),J&&ra(J)},Ma=()=>{k.width=512*c.resolution,k.height=k.width/c.aspect,_=c.margin*c.resolution,X=c.buttonHeight*c.resolution,J&&ra(J)},la=()=>{const a=(a,r)=>(P=k.getBoundingClientRect(),a-=P.x,r-=P.y,[a*c.resolution,r*c.resolution]);document.addEventListener("mousemove",r=>{ha(...a(r.clientX,r.clientY))}),k.addEventListener("mousedown",r=>{ca(!0,...a(r.clientX,r.clientY)),r.preventDefault()}),document.addEventListener("mouseup",a=>{ca(!1)}),document.addEventListener("touchmove",r=>{const c=r.touches[0];ha(...a(c.clientX,c.clientY)),r.preventDefault()},{passive:!1}),k.addEventListener("touchstart",r=>{const c=r.touches[0];ca(!0,...a(c.clientX,c.clientY)),r.preventDefault()},{passive:!1}),document.addEventListener("touchend",a=>{ca(!1)},{passive:!1})},oa=a=>{var r;(r="en",g=r,s=!1,new Promise((a,c)=>{if(i[g])return a();i[g]={},fetch("".concat("./wordlist/").concat(r,".txt")).then(a=>a.text()).then(r=>{d(r),s=!0,a()}).catch(a=>{c(a)})})).then(()=>{}),M().then(()=>{ia()}),Object.assign(c,a),R=c.language,Ma(),aa("en")};let na=!0;const ua=a=>{na=a},ja=(a,r,c,t,h)=>{c<2*h&&(h=c/2),t<2*h&&(h=t/2),v.beginPath(),v.moveTo(a+h,r),v.arcTo(a+c,r,a+c,r+t,h),v.arcTo(a+c,r+t,a,r+t,h),v.arcTo(a,r+t,a,r,h),v.arcTo(a,r,a+c,r,h),v.closePath(),v.fill()},La=(a,r,t,h,e,M)=>{if(M||(M=c.fontSize*c.resolution),v.font="".concat(M,"px ").concat(c.font),v.textBaseline="middle",!e)return;const l=(t-v.measureText(e).width)/2,o=h/2;v.fillText(e,a+l,r+o)},ia=()=>{const a=wa();v.clearRect(0,0,k.width,k.height),v.shadowBlur=c.keyShadow.shadowBlur,v.shadowOffsetX=c.keyShadow.shadowOffsetX,v.shadowOffsetY=c.keyShadow.shadowOffsetY;let r=a;for(let a=0;a<H.length;a++){const t=H[a];let h=_+Sa()+da(a);for(let a=0;a<t.length;a++){const e=t[a];let M=e.w?e.w:1;v.fillStyle=c.colors.hover,e.down?v.fillStyle=c.colors.down:e.hover?v.fillStyle=c.colors.hover:v.fillStyle=c.colors.idle;let o=Z*M;if(o+=(M-1)*_,v.shadowColor=c.keyShadow.shadowColor,ja(h,r,o,X,c.buttonRadius*c.resolution),v.shadowColor="transparent",v.fillStyle=c.colors.text,e.pos={x:h,y:r},["shift","bksp","enter","lang"].includes(e.char)){let a=e.char;"shift"===e.char&&V&&(a="shift_down"),"shift"===e.char&&$&&(a="shift_perm"),l(v,h,r,o,X,a)}else{let a=V&&1===e.char.length?e.char.toUpperCase():e.char;if("space"===a&&(a="␣"),La(h,r,o,X,a),e.alt){const a=.6*c.fontSize*c.resolution;La(h+o/2-a/2,r-X/2+a,o,X,e.alt,a)}}h+=o+_}r+=X+_}if(v.shadowBlur=c.popupShadow.shadowBlur,v.shadowOffsetX=c.popupShadow.shadowOffsetX,v.shadowOffsetY=c.popupShadow.shadowOffsetY,b&&b.extra&&b.down){const{pos:a}=b,{startX:r,startY:t,keyArr:h,popupWidth:e,popupHeight:M}=Aa(a,F?[...b.extra]:[b]);v.fillStyle=c.colors.idle,v.shadowColor=c.popupShadow.shadowColor,ja(r,t-X*(h.length-1),e,M,c.buttonRadius*c.resolution),ja(a.x,a.y-X,Z,2*X,c.buttonRadius*c.resolution),v.shadowColor="transparent";let l=t;for(let a=0;a<h.length;a++){const t=h[a];let e=r;for(let a=0;a<t.length;a++){const r=t[a];r.down?v.fillStyle=c.colors.down:r.hover?v.fillStyle=c.colors.hover:v.fillStyle=c.colors.idle,ja(e,l,Z,X,c.buttonRadius*c.resolution),v.fillStyle=c.colors.text;const h=V&&r.char.length<=2?r.char.toUpperCase():r.char;La(e,l,Z,X,h),F||La(e,l+X/2,Z,X/2,"..."),e+=Z}l-=X}}na=!0},sa=()=>{const{x:a,y:r}=U,c=wa(),t=Math.floor((r-c)/(X+_)),h=H[t];if(!h)return;let e=_+Sa()+da(t);for(let r=0;r<h.length;r++){const c=h[r];let t=c.w?c.w:1,M=Z*t;M+=(t-1)*_;let l=a>e;if(e+=M+_,l&&a<e-_){if(!b||b!==c||b.down!==W){if(b===c&&b.down&&!W)return ga(b);xa(),b=c,b.hover=!0,b.down=W,b.down?ya():Ta(),ia()}return b}}},Na=()=>{if(!b||!b.extra)return;if(!W)return ga(m),!0;const{x:a,y:r}=U,{pos:c}=b,{startX:t,startY:h,keyArr:e,popupWidth:M,popupHeight:l}=Aa(c,[...b.extra]);let o=null,n=Number.POSITIVE_INFINITY,u=h+X/2;for(let c=0;c<e.length;c++){const h=e[c];let M=t+Z/2;for(let c=0;c<h.length;c++){const t=h[c],e=a-M,l=r-u,j=Math.sqrt(e*e+l*l);j<n&&(o=t,n=j),M+=Z}u-=X}return m&&m===o&&m.down===W||(Ia(),m=o,m.hover=!0,m.down=!0,ia()),a>t&&a<t+M&&r>h-X*(e.length-1)&&r<h-X*(e.length-1)+l||a>c.x&&a<c.x+Z&&r>c.y-X&&r<c.y+X},ga=r=>{Ia(),xa(),Ta();let c=!0;switch(u(r.char,V),r.char){case"abc":ra(R);break;case"!?#":case"?123":ra("num");break;case"=\\<":ra("sym");break;case"1234":ra("nump");break;case"shift":!$&&Date.now()-q<300?(V=!0,$=!0,q=0):(V=!V,$=!1,q=Date.now()),c=!1;break;case"lang":for(let r=0;r<a.length;r++)if(a[r]===R){let c=r+1;a[c]||(c=0),aa(a[c]);break}break;default:a.includes(r.char.toLowerCase())?aa(r.char.toLowerCase()):(V&&!$&&(V=!1),c=!1)}return c||ia(),r},xa=()=>{b&&(b.hover=!1,b.down=!1,b=null)},Ia=()=>{m&&(m.hover=!1,m.down=!1,m=null)},Ta=()=>{G&&clearTimeout(G),K&&clearInterval(K),F=!1},ya=()=>{Ta(),G=setTimeout(()=>{F=!0,Ia(),Na(),b&&"bksp"===b.char&&(K=setInterval(()=>{b&&u(b.char)},c.bkspIntervalTime))},c.holdPopupTime)},wa=()=>"center"===c.align?k.height/2-H.length*X*.5:2*X+4*_,Da=()=>{let a=0;for(let r=0;r<H.length;r++){const c=H[r];let t=0;for(let a=0;a<c.length;a++){const r=c[a];t+=r.w?r.w:1}t>a&&(a=t)}return a},Sa=()=>{let a=Da();const r=(B-a)/2;return r*Z+r*_},da=a=>{const r=H[a];let c=0;for(let a=0;a<r.length;a++){const t=r[a];c+=t.w?t.w:1}const t=(B-c)/2;return t*Z+t*_},za=()=>(H.length*X+(H.length+1)*_+(2*X+3*_))/c.resolution,Aa=(a,r)=>{let c=5;r.length>c&&(c=Math.ceil(r.length/2));const t=new Array(Math.ceil(r.length/c)).fill().map(a=>r.splice(0,c)),h=t[0].length*Z,e=t.length*X,M=Math.floor(t[0].length/2)*Z;let l=a.x-M;for(t[0].length>1&&t[0].length%2==0&&(l+=Z);l<0;)l+=Z;for(;l+t[0].length*Z>k.width;)l-=Z;return{keyArr:t,popupWidth:h,popupHeight:e,startX:l,startY:a.y-X-3*_}};export{b as activeElement,la as addListeners,k as canvas,L as events,oa as init,aa as selectLanguage,ra as setLayout,ca as setMouseDown,ha as setMousePos,ta as setMousePosFromUV,Ma as setScreenSizeFromAspectRatio,ea as setScreenSizeInPixels,ua as setTextureDirty,na as textureDirty};
